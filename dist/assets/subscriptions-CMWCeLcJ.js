import{j as e}from"./ui-vendor-mfLK6kkQ.js";import{r as f}from"./react-vendor--0RGCJ5T.js";import{b as ce,d as q,e as v,g as l,P as w,j as h,n as F,k as p,o as L,B as j,p as $,ah as de,U as me,T as oe,D as z,E as O,F as B,G as I,H as K,I as n,J as c,K as H,f as N,aq as b}from"./index-DMUxz8dE.js";import{S as Q,a as V,b as R,c as _,d as x}from"./select-Brp6yn3A.js";import{T as xe,a as ue,b as k,c as D}from"./tabs-CFs29E2A.js";import{S as he,a as pe}from"./Sidebar-CWwWAgFd.js";import{H as je}from"./Header-CZNG9THd.js";import{T as U}from"./trash-2-DEwSYusZ.js";import{D as ge}from"./dollar-sign-BsbVyGJM.js";import{C as ye}from"./calendar-CAkEv8Jh.js";import"./chart-vendor-CJvGuOij.js";import"./index-BdQq_4o_.js";import"./index-BBVDPgwe.js";import"./chevron-down-BE_ioXd1.js";import"./activity-Dkd0t9nU.js";import"./message-square-DEryHNXU.js";import"./file-text-CVGYDGjh.js";import"./NotificationCenter-CPdR7ta7.js";import"./volume-2-Cn_3p6P5.js";import"./circle-check-big-DJe8srSt.js";import"./info-KqEO34od.js";function Be(){var A;const[i,d]=f.useState(null),[Y,g]=f.useState(!1),[G,y]=f.useState(!1),[r,m]=f.useState({name:"",tier:"",monthlyPrice:0,yearlyPrice:0,features:[""],maxSignals:0,maxTickers:0}),{toast:u}=ce(),{data:S=[],isLoading:J}=q({queryKey:["/api/admin/subscriptions"]}),{data:W=[],isLoading:X}=q({queryKey:["/api/subscription-plans"]}),C=v({mutationFn:async s=>(await N("POST","/api/admin/subscription-plans",s)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/subscription-plans"]}),y(!1),m({name:"",tier:"",monthlyPrice:0,yearlyPrice:0,features:[""],maxSignals:0,maxTickers:0}),u({title:"Plan Created",description:"Subscription plan created successfully."})},onError:s=>{u({title:"Creation Failed",description:s.message||"Failed to create plan",variant:"destructive"})}}),P=v({mutationFn:async({id:s,data:a})=>(await N("PUT",`/api/admin/subscription-plans/${s}`,a)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/subscription-plans"]}),g(!1),d(null),u({title:"Plan Updated",description:"Subscription plan updated successfully."})},onError:s=>{u({title:"Update Failed",description:s.message||"Failed to update plan",variant:"destructive"})}}),E=v({mutationFn:async s=>(await N("DELETE",`/api/admin/subscription-plans/${s}`)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/subscription-plans"]}),u({title:"Plan Deleted",description:"Subscription plan deleted successfully."})},onError:s=>{u({title:"Delete Failed",description:s.message||"Failed to delete plan",variant:"destructive"})}}),M=v({mutationFn:async s=>(await N("POST",`/api/admin/subscriptions/${s}/cancel`)).json(),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/admin/subscriptions"]}),u({title:"Subscription Cancelled",description:"User subscription has been cancelled."})}}),Z=s=>{switch(s){case"active":return e.jsx(j,{variant:"default",children:"Active"});case"cancelled":return e.jsx(j,{variant:"destructive",children:"Cancelled"});case"expired":return e.jsx(j,{variant:"secondary",children:"Expired"});case"pending":return e.jsx(j,{variant:"outline",children:"Pending"});default:return e.jsx(j,{variant:"outline",children:"Unknown"})}},T=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s/100),ee=s=>{d(s),g(!0)},se=()=>{if(!i)return;const s={...i,features:i.features.filter(a=>a.trim()),monthlyPrice:i.monthlyPrice,yearlyPrice:i.yearlyPrice,maxSignals:i.maxSignals===0?-1:i.maxSignals,maxTickers:i.maxTickers===0?-1:i.maxTickers};P.mutate({id:i.id,data:s})},ae=s=>{confirm("Are you sure you want to delete this plan? This action cannot be undone.")&&E.mutate(s)},ie=()=>{const s={...r,features:r.features.filter(a=>a.trim()),monthlyPrice:r.monthlyPrice*100,yearlyPrice:r.yearlyPrice?r.yearlyPrice*100:null,maxSignals:r.maxSignals===0?-1:r.maxSignals,maxTickers:r.maxTickers===0?-1:r.maxTickers};C.mutate(s)},re=(s,a)=>{const t=[...r.features];t[s]=a,m(o=>({...o,features:t}))},te=()=>{m(s=>({...s,features:[...s.features,""]}))},ne=s=>{const a=r.features.filter((t,o)=>o!==s);m(t=>({...t,features:a}))};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"flex",children:[e.jsx(he,{className:"hidden lg:block lg:w-64"}),e.jsxs("div",{className:"flex-1 lg:ml-64",children:[e.jsx(je,{title:"Subscription Management",subtitle:"Manage subscription plans and user subscriptions",children:e.jsxs(l,{onClick:()=>y(!0),children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Create Plan"]})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[e.jsxs(xe,{defaultValue:"plans",className:"space-y-4",children:[e.jsxs(ue,{children:[e.jsx(k,{value:"plans",children:"Subscription Plans"}),e.jsx(k,{value:"users",children:"User Subscriptions"}),e.jsx(k,{value:"analytics",children:"Subscription Analytics"})]}),e.jsx(D,{value:"plans",className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:X?Array.from({length:4}).map((s,a)=>e.jsxs(h,{className:"animate-pulse",children:[e.jsxs(F,{children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})})]},a)):W.map(s=>{var a;return e.jsxs(h,{className:s.isActive?"":"opacity-60",children:[e.jsx(F,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[s.name,!s.isActive&&e.jsx(j,{variant:"secondary",children:"Inactive"})]}),e.jsxs($,{className:"capitalize",children:[s.tier," tier"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>ee(s),children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>ae(s.id),disabled:E.isPending,children:e.jsx(U,{className:"h-4 w-4"})})]})]})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:T(s.monthlyPrice)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"per month"}),s.yearlyPrice&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[T(s.yearlyPrice)," per year"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Features:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[(a=s.features)==null?void 0:a.slice(0,3).map((t,o)=>e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{className:"w-1 h-1 bg-primary rounded-full mr-2"}),t]},o)),s.features&&s.features.length>3&&e.jsxs("li",{className:"text-xs",children:["+",s.features.length-3," more"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Signals"}),e.jsx("p",{className:"text-muted-foreground",children:s.maxSignals===-1?"Unlimited":s.maxSignals})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Tickers"}),e.jsx("p",{className:"text-muted-foreground",children:s.maxTickers===-1?"Unlimited":s.maxTickers})]})]})]})})]},s.id)})})}),e.jsx(D,{value:"users",className:"space-y-4",children:e.jsxs(h,{children:[e.jsxs(F,{children:[e.jsx(L,{children:"User Subscriptions"}),e.jsx($,{children:"Manage individual user subscriptions"})]}),e.jsx(p,{children:J?e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((s,a)=>e.jsx("div",{className:"h-16 bg-gray-100 rounded animate-pulse"},a))}):S.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(de,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No active subscriptions"})]}):e.jsx("div",{className:"space-y-2",children:S.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.userName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.userEmail})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.planName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[T(s.amount)," â€¢ Next payment: ",new Date(s.nextPayment).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Z(s.status),s.status==="active"&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>M.mutate(s.id),disabled:M.isPending,children:"Cancel"})]})]},s.id))})})]})}),e.jsx(D,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(h,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Subscriptions"}),e.jsx("p",{className:"text-2xl font-bold",children:S.filter(s=>s.status==="active").length})]}),e.jsx(me,{className:"h-8 w-8 text-muted-foreground"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"+5% from last month"})]})}),e.jsx(h,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Monthly Revenue"}),e.jsx("p",{className:"text-2xl font-bold",children:"$12,450"})]}),e.jsx(ge,{className:"h-8 w-8 text-muted-foreground"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"+12% from last month"})]})}),e.jsx(h,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Churn Rate"}),e.jsx("p",{className:"text-2xl font-bold",children:"2.3%"})]}),e.jsx(oe,{className:"h-8 w-8 text-muted-foreground"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"-0.5% from last month"})]})}),e.jsx(h,{children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg LTV"}),e.jsx("p",{className:"text-2xl font-bold",children:"$287"})]}),e.jsx(ye,{className:"h-8 w-8 text-muted-foreground"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"+8% from last month"})]})})]})})]}),e.jsx(z,{open:Y,onOpenChange:g,children:e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(B,{children:[e.jsx(I,{children:"Edit Subscription Plan"}),e.jsx(K,{children:"Update the details of this subscription plan."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-name",children:"Plan Name"}),e.jsx(c,{id:"edit-name",value:(i==null?void 0:i.name)||"",onChange:s=>d(a=>a?{...a,name:s.target.value}:null),placeholder:"Basic Plan"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-tier",children:"Tier"}),e.jsxs(Q,{value:(i==null?void 0:i.tier)||"",onValueChange:s=>d(a=>a?{...a,tier:s}:null),children:[e.jsx(V,{children:e.jsx(R,{placeholder:"Select tier"})}),e.jsxs(_,{children:[e.jsx(x,{value:"free",children:"Free"}),e.jsx(x,{value:"basic",children:"Basic"}),e.jsx(x,{value:"premium",children:"Premium"}),e.jsx(x,{value:"pro",children:"Pro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-monthly-price",children:"Monthly Price ($)"}),e.jsx(c,{id:"edit-monthly-price",type:"number",value:i!=null&&i.monthlyPrice?i.monthlyPrice/100:0,onChange:s=>d(a=>a?{...a,monthlyPrice:Number(s.target.value)*100}:null),placeholder:"29.99"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-yearly-price",children:"Yearly Price ($, optional)"}),e.jsx(c,{id:"edit-yearly-price",type:"number",value:i!=null&&i.yearlyPrice?i.yearlyPrice/100:0,onChange:s=>d(a=>a?{...a,yearlyPrice:Number(s.target.value)*100}:null),placeholder:"299.99"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-max-signals",children:"Max Signals (0 = unlimited)"}),e.jsx(c,{id:"edit-max-signals",type:"number",value:(i==null?void 0:i.maxSignals)===-1?0:(i==null?void 0:i.maxSignals)||0,onChange:s=>d(a=>a?{...a,maxSignals:Number(s.target.value)}:null),placeholder:"100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-max-tickers",children:"Max Tickers (0 = unlimited)"}),e.jsx(c,{id:"edit-max-tickers",type:"number",value:(i==null?void 0:i.maxTickers)===-1?0:(i==null?void 0:i.maxTickers)||0,onChange:s=>d(a=>a?{...a,maxTickers:Number(s.target.value)}:null),placeholder:"10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Features"}),(A=i==null?void 0:i.features)==null?void 0:A.map((s,a)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{value:s,onChange:t=>{if(i){const o=[...i.features];o[a]=t.target.value,d({...i,features:o})}},placeholder:"Feature description"}),i.features.length>1&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{if(i){const t=i.features.filter((o,le)=>le!==a);d({...i,features:t})}},children:e.jsx(U,{className:"h-4 w-4"})})]},a)),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{i&&d({...i,features:[...i.features,""]})},children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Add Feature"]})]}),e.jsxs(H,{children:[e.jsx(l,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(l,{onClick:se,disabled:P.isPending,children:P.isPending?"Updating...":"Update Plan"})]})]})}),e.jsx(z,{open:G,onOpenChange:y,children:e.jsxs(O,{className:"max-w-2xl",children:[e.jsxs(B,{children:[e.jsx(I,{children:"Create Subscription Plan"}),e.jsx(K,{children:"Add a new subscription plan to your platform"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"plan-name",children:"Plan Name"}),e.jsx(c,{id:"plan-name",value:r.name,onChange:s=>m(a=>({...a,name:s.target.value})),placeholder:"e.g., Pro Plan"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"plan-tier",children:"Tier"}),e.jsxs(Q,{value:r.tier,onValueChange:s=>m(a=>({...a,tier:s})),children:[e.jsx(V,{children:e.jsx(R,{placeholder:"Select tier"})}),e.jsxs(_,{children:[e.jsx(x,{value:"free",children:"Free"}),e.jsx(x,{value:"basic",children:"Basic"}),e.jsx(x,{value:"premium",children:"Premium"}),e.jsx(x,{value:"pro",children:"Pro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"monthly-price",children:"Monthly Price ($)"}),e.jsx(c,{id:"monthly-price",type:"number",value:r.monthlyPrice,onChange:s=>m(a=>({...a,monthlyPrice:Number(s.target.value)})),placeholder:"29.99"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"yearly-price",children:"Yearly Price ($)"}),e.jsx(c,{id:"yearly-price",type:"number",value:r.yearlyPrice,onChange:s=>m(a=>({...a,yearlyPrice:Number(s.target.value)})),placeholder:"299.99"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"max-signals",children:"Max Signals (0 = unlimited)"}),e.jsx(c,{id:"max-signals",type:"number",value:r.maxSignals,onChange:s=>m(a=>({...a,maxSignals:Number(s.target.value)})),placeholder:"100"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"max-tickers",children:"Max Tickers (0 = unlimited)"}),e.jsx(c,{id:"max-tickers",type:"number",value:r.maxTickers,onChange:s=>m(a=>({...a,maxTickers:Number(s.target.value)})),placeholder:"10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Features"}),r.features.map((s,a)=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{value:s,onChange:t=>re(a,t.target.value),placeholder:"Feature description"}),r.features.length>1&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>ne(a),children:e.jsx(U,{className:"h-4 w-4"})})]},a)),e.jsxs(l,{variant:"outline",size:"sm",onClick:te,children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Add Feature"]})]}),e.jsxs(H,{children:[e.jsx(l,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(l,{onClick:ie,disabled:C.isPending,children:C.isPending?"Creating...":"Create Plan"})]})]})})]})]})]})})}export{Be as default};
//# sourceMappingURL=subscriptions-CMWCeLcJ.js.map
