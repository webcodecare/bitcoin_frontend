import{j as e}from"./ui-vendor-mfLK6kkQ.js";import{r as D}from"./react-vendor--0RGCJ5T.js";import{b as J,a as _,d as w,e as q,j as h,n as j,o as u,O as C,k as p,B as o,w as A,m as k,g as a,Q as $,y as V,I as t,J as c,P as U,f as y}from"./index-DMUxz8dE.js";import{S as X,a as z}from"./Sidebar-CWwWAgFd.js";import{H as G}from"./Header-CZNG9THd.js";import{S as E}from"./switch-6PBAG7U5.js";import{T as Q,a as B,b as g,c as n,d as L,e as i}from"./table-C5Wewpyf.js";import{M}from"./message-square-DEryHNXU.js";import{T as W}from"./trash-2-DEwSYusZ.js";import{C as Y}from"./circle-x-CG5ILRXV.js";import{C as Z}from"./circle-check-big-DJe8srSt.js";import{S as ee}from"./send-y-4Jk6HA.js";import"./chart-vendor-CJvGuOij.js";import"./activity-Dkd0t9nU.js";import"./dollar-sign-BsbVyGJM.js";import"./file-text-CVGYDGjh.js";import"./NotificationCenter-CPdR7ta7.js";import"./index-BdQq_4o_.js";import"./tabs-CFs29E2A.js";import"./volume-2-Cn_3p6P5.js";import"./info-KqEO34od.js";import"./index-BBVDPgwe.js";function Se(){const{toast:T}=J(),I=_(),[N,P]=D.useState("queue"),{data:m,isLoading:se}=w({queryKey:["/api/admin/notification-configs"],queryFn:async()=>await y("/api/admin/notification-configs")}),{data:f,isLoading:H}=w({queryKey:["/api/admin/notification-queue"],queryFn:async()=>await y("/api/admin/notification-queue"),refetchInterval:5e3});w({queryKey:["/api/admin/notification-queue/stats"],queryFn:async()=>await y("/api/admin/notification-queue/stats"),refetchInterval:1e4}),w({queryKey:["/api/admin/notification-processor/status"],queryFn:async()=>await y("/api/admin/notification-processor/status"),refetchInterval:15e3});const{data:b,isLoading:O}=w({queryKey:["/api/admin/notification-templates"],queryFn:async()=>await y("/api/admin/notification-templates")}),v=q({mutationFn:async({id:s,enabled:x})=>{await y(`/api/admin/notification-configs/${s}/toggle`,{method:"PATCH",body:JSON.stringify({enabled:x})})},onSuccess:()=>{I.invalidateQueries({queryKey:["/api/admin/notification-configs"]}),T({title:"Success",description:"Notification configuration updated"})}}),F=q({mutationFn:async s=>{await y(`/api/admin/notifications/${s}/retry`,{method:"POST"})},onSuccess:()=>{I.invalidateQueries({queryKey:["/api/admin/notification-queue"]}),T({title:"Success",description:"Notification retry initiated"})}}),S=q({mutationFn:async({type:s,recipient:x})=>{await y("/api/admin/notifications/test",{method:"POST",body:JSON.stringify({type:s,recipient:x})})},onSuccess:()=>{T({title:"Success",description:"Test notification sent"})}}),R=s=>{switch(s){case"sent":return e.jsxs(o,{variant:"default",className:"bg-emerald-500",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Sent"]});case"failed":return e.jsxs(o,{variant:"destructive",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"Failed"]});case"pending":return e.jsxs(o,{variant:"secondary",children:[e.jsx(k,{className:"w-3 h-3 mr-1"}),"Pending"]});default:return e.jsx(o,{variant:"outline",children:s})}},K=s=>{switch(s){case"email":return e.jsx(C,{className:"w-4 h-4"});case"sms":return e.jsx(M,{className:"w-4 h-4"});case"push":return e.jsx(A,{className:"w-4 h-4"});default:return e.jsx(ee,{className:"w-4 h-4"})}},r=m==null?void 0:m.find(s=>s.type==="email"),l=m==null?void 0:m.find(s=>s.type==="sms"),d=m==null?void 0:m.find(s=>s.type==="push");return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"flex",children:[e.jsx(X,{className:"hidden lg:block lg:w-64"}),e.jsxs("div",{className:"flex-1 lg:ml-64",children:[e.jsx(G,{title:"Notification System",subtitle:"Manage email, SMS, and push notification delivery"}),e.jsx("main",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6",children:[e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Email Enabled"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(o,{variant:r!=null&&r.isEnabled?"default":"secondary",children:r!=null&&r.isEnabled?"Active":"Inactive"})})})]}),e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"SMS Enabled"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(o,{variant:l!=null&&l.isEnabled?"default":"secondary",children:l!=null&&l.isEnabled?"Active":"Inactive"})})})]}),e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Push Enabled"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold",children:e.jsx(o,{variant:d!=null&&d.isEnabled?"default":"secondary",children:d!=null&&d.isEnabled?"Active":"Inactive"})})})]}),e.jsxs(h,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Queue Size"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold",children:(f==null?void 0:f.filter(s=>s.status==="pending").length)||0})})]})]}),e.jsxs("div",{className:"flex space-x-1 bg-muted p-1 rounded-lg w-fit",children:[e.jsxs(a,{variant:N==="queue"?"default":"ghost",size:"sm",onClick:()=>P("queue"),children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Queue"]}),e.jsxs(a,{variant:N==="config"?"default":"ghost",size:"sm",onClick:()=>P("config"),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Configuration"]}),e.jsxs(a,{variant:N==="templates"?"default":"ghost",size:"sm",onClick:()=>P("templates"),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Templates"]})]}),N==="queue"&&e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(u,{children:"Notification Queue"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor notification delivery status"})]}),e.jsx(p,{children:H?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,x)=>e.jsx(V,{className:"h-12 w-full"},x))}):e.jsxs(Q,{children:[e.jsx(B,{children:e.jsxs(g,{children:[e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Recipient"}),e.jsx(n,{children:"Subject"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Attempts"}),e.jsx(n,{children:"Created"}),e.jsx(n,{children:"Actions"})]})}),e.jsxs(L,{children:[f==null?void 0:f.slice(0,20).map(s=>e.jsxs(g,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[K(s.type),e.jsx("span",{className:"capitalize",children:s.type})]})}),e.jsx(i,{className:"max-w-xs truncate",children:s.recipient}),e.jsx(i,{className:"max-w-xs truncate",children:s.subject}),e.jsx(i,{children:R(s.status)}),e.jsx(i,{children:s.attempts}),e.jsx(i,{children:new Date(s.createdAt).toLocaleString()}),e.jsx(i,{children:s.status==="failed"&&e.jsx(a,{variant:"outline",size:"sm",onClick:()=>F.mutate(s.id),disabled:F.isPending,children:"Retry"})})]},s.id)),(!f||f.length===0)&&e.jsx(g,{children:e.jsx(i,{colSpan:7,className:"text-center text-muted-foreground",children:"No notifications in queue"})})]})]})})]}),N==="config"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"w-5 h-5"}),e.jsx(u,{children:"Email Configuration"})]}),e.jsx(E,{checked:(r==null?void 0:r.isEnabled)||!1,onCheckedChange:s=>r&&v.mutate({id:r.id,enabled:s}),disabled:v.isPending})]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"SMTP Server"}),e.jsx(c,{defaultValue:"smtp.sendgrid.net"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Port"}),e.jsx(c,{defaultValue:"587"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Username"}),e.jsx(c,{defaultValue:"apikey"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"API Key"}),e.jsx(c,{type:"password",placeholder:"sg.xxx"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"From Email"}),e.jsx(c,{defaultValue:"alerts@cryptostrategy.pro"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"From Name"}),e.jsx(c,{defaultValue:"Proud Profits"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(a,{variant:"outline",children:"Save Changes"}),e.jsx(a,{variant:"outline",onClick:()=>S.mutate({type:"email",recipient:"test@example.com"}),disabled:S.isPending,children:"Send Test Email"})]})]})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"w-5 h-5"}),e.jsx(u,{children:"SMS Configuration (Twilio)"})]}),e.jsx(E,{checked:(l==null?void 0:l.isEnabled)||!1,onCheckedChange:s=>l&&v.mutate({id:l.id,enabled:s}),disabled:v.isPending})]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Account SID"}),e.jsx(c,{type:"password",placeholder:"ACxxxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Auth Token"}),e.jsx(c,{type:"password",placeholder:"xxxxxxxxxx"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"From Phone Number"}),e.jsx(c,{defaultValue:"+1234567890"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(a,{variant:"outline",children:"Save Changes"}),e.jsx(a,{variant:"outline",onClick:()=>S.mutate({type:"sms",recipient:"+1234567890"}),disabled:S.isPending,children:"Send Test SMS"})]})]})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx(u,{children:"Push Notification Configuration"})]}),e.jsx(E,{checked:(d==null?void 0:d.isEnabled)||!1,onCheckedChange:s=>d&&v.mutate({id:d.id,enabled:s}),disabled:v.isPending})]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"VAPID Public Key"}),e.jsx(c,{type:"password",placeholder:"BK..."})]}),e.jsxs("div",{children:[e.jsx(t,{children:"VAPID Private Key"}),e.jsx(c,{type:"password",placeholder:"..."})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Subject"}),e.jsx(c,{defaultValue:"mailto:admin@cryptostrategy.pro"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(a,{variant:"outline",children:"Save Changes"}),e.jsx(a,{variant:"outline",children:"Send Test Push"})]})]})]})]}),N==="templates"&&e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Notification Templates"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage message templates for different notification types"})]}),e.jsxs(a,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Add Template"]})]})}),e.jsx(p,{children:O?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((s,x)=>e.jsx(V,{className:"h-16 w-full"},x))}):e.jsxs(Q,{children:[e.jsx(B,{children:e.jsxs(g,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Subject"}),e.jsx(n,{children:"Variables"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Actions"})]})}),e.jsxs(L,{children:[b==null?void 0:b.map(s=>e.jsxs(g,{children:[e.jsx(i,{className:"font-medium",children:s.name}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[K(s.type),e.jsx("span",{className:"capitalize",children:s.type})]})}),e.jsx(i,{className:"max-w-xs truncate",children:s.subject}),e.jsx(i,{children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.variables.slice(0,3).map(x=>e.jsx(o,{variant:"outline",className:"text-xs",children:x},x)),s.variables.length>3&&e.jsxs(o,{variant:"outline",className:"text-xs",children:["+",s.variables.length-3]})]})}),e.jsx(i,{children:e.jsx(o,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",children:e.jsx(z,{className:"w-3 h-3"})}),e.jsx(a,{variant:"outline",size:"sm",children:e.jsx(W,{className:"w-3 h-3"})})]})})]},s.id)),(!b||b.length===0)&&e.jsx(g,{children:e.jsx(i,{colSpan:6,className:"text-center text-muted-foreground",children:"No notification templates found"})})]})]})})]})]})})]})]})})}export{Se as default};
//# sourceMappingURL=notifications-BLYUskWk.js.map
