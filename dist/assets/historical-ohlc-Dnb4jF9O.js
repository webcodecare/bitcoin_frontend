import{j as e}from"./ui-vendor-mfLK6kkQ.js";import{r as c}from"./react-vendor--0RGCJ5T.js";import{j as v,n as y,o as T,k as g,I as j,J as E,g as I,l as Z,d as O,B as A}from"./index-DMUxz8dE.js";import{S as W}from"./Sidebar-CWwWAgFd.js";import{H as X}from"./Header-CZNG9THd.js";import{S as F,a as V,b as Q,c as U,d as R}from"./select-Brp6yn3A.js";import{R as $}from"./refresh-cw-CQdY5ta9.js";import{D as q}from"./database-CQRgTe4X.js";import{A as Y}from"./activity-Dkd0t9nU.js";import{D as ee}from"./download-DAUaHPRv.js";import{I as se}from"./ImplementationStatus-qCHaiXnw.js";import{T as ae,a as te,b as D,c as H}from"./tabs-CFs29E2A.js";import{C as le}from"./circle-check-big-DJe8srSt.js";import"./chart-vendor-CJvGuOij.js";import"./dollar-sign-BsbVyGJM.js";import"./message-square-DEryHNXU.js";import"./file-text-CVGYDGjh.js";import"./NotificationCenter-CPdR7ta7.js";import"./index-BdQq_4o_.js";import"./volume-2-Cn_3p6P5.js";import"./info-KqEO34od.js";import"./index-BBVDPgwe.js";import"./chevron-down-BE_ioXd1.js";import"./circle-x-CG5ILRXV.js";function ie({symbol:t,setSymbol:d,interval:r,setInterval:i,limit:m,setLimit:C,startTime:o,setStartTime:w,endTime:x,setEndTime:S,queryParams:h,availableTickers:u,intervals:N,handleQuery:k,refetch:l,isLoading:b}){return e.jsxs(v,{className:"p-3 sm:p-4",children:[e.jsxs(y,{className:"p-0 pb-3",children:[e.jsx(T,{className:"text-sm sm:text-base",children:"OHLC Data Query"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Query historical OHLC data with cache-first strategy and Binance fallback"})]}),e.jsxs(g,{className:"p-0 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"symbol",className:"text-xs sm:text-sm",children:"Symbol"}),e.jsxs(F,{value:t,onValueChange:d,children:[e.jsx(V,{className:"text-xs sm:text-sm",children:e.jsx(Q,{})}),e.jsx(U,{children:u==null?void 0:u.filter(a=>a.enabled).map(a=>e.jsx(R,{value:a.symbol,children:a.symbol},a.symbol))})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"interval",className:"text-xs sm:text-sm",children:"Interval"}),e.jsxs(F,{value:r,onValueChange:i,children:[e.jsx(V,{className:"text-xs sm:text-sm",children:e.jsx(Q,{})}),e.jsx(U,{children:N.map(a=>e.jsx(R,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"limit",className:"text-xs sm:text-sm",children:"Limit (max 5000)"}),e.jsx(E,{type:"number",value:m,onChange:a=>C(Math.min(5e3,parseInt(a.target.value)||100)),min:"1",max:"5000",className:"text-xs sm:text-sm"})]}),e.jsxs("div",{className:"sm:col-span-2 lg:col-span-1",children:[e.jsx(j,{htmlFor:"startTime",className:"text-xs sm:text-sm",children:"Start Time (Optional)"}),e.jsx(E,{type:"datetime-local",value:o,onChange:a=>w(a.target.value),className:"text-xs sm:text-sm"})]}),e.jsxs("div",{className:"sm:col-span-2 lg:col-span-1",children:[e.jsx(j,{htmlFor:"endTime",className:"text-xs sm:text-sm",children:"End Time (Optional)"}),e.jsx(E,{type:"datetime-local",value:x,onChange:a=>S(a.target.value),className:"text-xs sm:text-sm"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(I,{onClick:k,disabled:b,className:"flex-1 sm:flex-none text-xs sm:text-sm",children:[b?e.jsx($,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2 animate-spin"}):e.jsx(Z,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Query OHLC Data"]}),e.jsxs(I,{variant:"outline",onClick:()=>l(),className:"flex-1 sm:flex-none text-xs sm:text-sm",children:[e.jsx($,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Refresh"]})]}),e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsxs("div",{className:"text-xs font-mono break-all",children:["GET /api/ohlc",h]})})]})]})}function re({ohlcResponse:t,downloadCSV:d}){const r=[{label:"Symbol",value:t.symbol,color:"text-blue-500"},{label:"Candles",value:t.count,color:"text-green-500"},{label:"Interval",value:t.interval,color:"text-purple-500"},{label:"Source",value:t.cached?e.jsxs("div",{className:"flex items-center justify-center text-orange-500",children:[e.jsx(q,{className:"h-3 w-3 sm:h-5 sm:w-5 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Cache"})]}):e.jsxs("div",{className:"flex items-center justify-center text-orange-500",children:[e.jsx(Y,{className:"h-3 w-3 sm:h-5 sm:w-5 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Live"})]}),color:"text-orange-500"},{label:"Data Type",value:t.external?"External":"Cached",color:"text-pink-500"}];return e.jsxs(v,{className:"p-3 sm:p-4",children:[e.jsx(y,{className:"p-0 pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{className:"text-sm sm:text-base",children:"Data Summary"}),e.jsxs(I,{variant:"outline",size:"sm",onClick:d,className:"text-xs",children:[e.jsx(ee,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Export "}),"CSV"]})]})}),e.jsx(g,{className:"p-0",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4",children:r.map((i,m)=>e.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[e.jsx("div",{className:`text-lg sm:text-2xl font-bold ${i.color}`,children:(typeof i.value=="object",i.value)}),e.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground",children:i.label})]},m))})})]})}function He(){const[t,d]=c.useState("BTCUSDT"),[r,i]=c.useState("1h"),[m,C]=c.useState(100),[o,w]=c.useState(""),[x,S]=c.useState(""),[h,u]=c.useState("?symbol=BTCUSDT&interval=1h&limit=100"),{data:N}=O({queryKey:["/api/tickers/enabled"]}),k=Array.isArray(N)?N:[],{data:l,isLoading:b,error:a,refetch:M}=O({queryKey:[`/api/ohlc${h}`],enabled:!!h}),P=[{value:"1m",label:"1 Minute"},{value:"5m",label:"5 Minutes"},{value:"15m",label:"15 Minutes"},{value:"30m",label:"30 Minutes"},{value:"1h",label:"1 Hour"},{value:"4h",label:"4 Hours"},{value:"12h",label:"12 Hours"},{value:"1d",label:"1 Day"},{value:"1w",label:"1 Week"},{value:"1M",label:"1 Month"}],G=()=>{let s=`?symbol=${t}&interval=${r}&limit=${m}`;o&&(s+=`&startTime=${o}`),x&&(s+=`&endTime=${x}`),u(s)},z=()=>{if(!(l!=null&&l.data.length))return;const p=[["Time","Open","High","Low","Close","Volume","Source"].join(","),...l.data.map(n=>[n.time,n.open,n.high,n.low,n.close,n.volume,n.source].join(","))].join(`
`),K=new Blob([p],{type:"text/csv"}),B=window.URL.createObjectURL(K),L=document.createElement("a");L.href=B,L.download=`${t}_${r}_ohlc.csv`,L.click(),window.URL.revokeObjectURL(B)},_=[{feature:"Supabase Edge Function: GET /api/ohlc",status:"implemented",description:"RESTful endpoint with comprehensive parameter validation and error handling"},{feature:"OHLC Cache Lookup with Binance Fallback",status:"implemented",description:"Intelligent cache-first strategy with automatic Binance REST API fallback"},{feature:"Normalize and Upsert OHLC Data",status:"implemented",description:"Binance kline format normalization with upsert operations to ohlc_cache table"},{feature:"Ticker Validation Against available_tickers",status:"implemented",description:"Enforces validation against enabled tickers in available_tickers table"},{feature:"Unit Tests for GET /api/ohlc",status:"implemented",description:"Comprehensive Jest test suite covering validation, caching, normalization, and error handling"}],f=s=>s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:8}),J=s=>s.toLocaleString(void 0,{maximumFractionDigits:2});return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"flex",children:[e.jsx(W,{}),e.jsxs("div",{className:"ml-0 md:ml-64 flex-1",children:[e.jsx(X,{title:"Historical OHLC Service"}),e.jsxs("div",{className:"p-3 sm:p-4 lg:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx(q,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-500"}),e.jsxs("h1",{className:"text-lg sm:text-2xl font-bold",children:[e.jsx("span",{className:"hidden sm:inline",children:"Historical OHLC Service"}),e.jsx("span",{className:"sm:hidden",children:"OHLC Service"})]})]}),e.jsxs(A,{variant:"outline",className:"text-green-600 border-green-600 text-xs px-2 py-1",children:[e.jsx("span",{className:"hidden sm:inline",children:"All Features "}),"Implemented"]})]}),e.jsx(se,{features:_}),e.jsxs(ae,{defaultValue:"query",className:"space-y-4 sm:space-y-6",children:[e.jsxs(te,{className:"grid w-full grid-cols-3 gap-1",children:[e.jsxs(D,{value:"query",className:"text-xs sm:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Query "}),"Interface"]}),e.jsx(D,{value:"data",className:"text-xs sm:text-sm",children:"Data View"}),e.jsxs(D,{value:"testing",className:"text-xs sm:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"API "}),"Testing"]})]}),e.jsx(H,{value:"query",className:"space-y-4 sm:space-y-6",children:e.jsx(ie,{symbol:t,setSymbol:d,interval:r,setInterval:i,limit:m,setLimit:C,startTime:o,setStartTime:w,endTime:x,setEndTime:S,queryParams:h,availableTickers:k,intervals:P,handleQuery:G,refetch:M,isLoading:b})}),e.jsxs(H,{value:"data",className:"space-y-4 sm:space-y-6",children:[a&&e.jsx(v,{className:"border-red-200 dark:border-red-800 p-3 sm:p-4",children:e.jsx(g,{className:"p-0",children:e.jsxs("div",{className:"text-red-600 dark:text-red-400 text-xs sm:text-sm",children:["Error: ",a.message]})})}),l&&e.jsxs(e.Fragment,{children:[e.jsx(re,{ohlcResponse:l,downloadCSV:z}),e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(T,{children:"OHLC Candles"})}),e.jsx(g,{children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Time"}),e.jsx("th",{className:"text-right p-2",children:"Open"}),e.jsx("th",{className:"text-right p-2",children:"High"}),e.jsx("th",{className:"text-right p-2",children:"Low"}),e.jsx("th",{className:"text-right p-2",children:"Close"}),e.jsx("th",{className:"text-right p-2",children:"Volume"}),e.jsx("th",{className:"text-center p-2",children:"Source"})]})}),e.jsx("tbody",{children:l.data.slice(0,50).map((s,p)=>e.jsxs("tr",{className:"border-b hover:bg-muted/20",children:[e.jsx("td",{className:"p-2 font-mono text-xs",children:new Date(s.time).toLocaleString()}),e.jsx("td",{className:"p-2 text-right font-mono",children:f(s.open)}),e.jsx("td",{className:"p-2 text-right font-mono text-green-600",children:f(s.high)}),e.jsx("td",{className:"p-2 text-right font-mono text-red-600",children:f(s.low)}),e.jsx("td",{className:"p-2 text-right font-mono",children:f(s.close)}),e.jsx("td",{className:"p-2 text-right font-mono text-xs",children:J(s.volume)}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(A,{variant:s.source==="cache"?"outline":"default",children:s.source})})]},p))})]}),l.data.length>50&&e.jsxs("div",{className:"text-center p-4 text-muted-foreground",children:["Showing first 50 of ",l.count," candles"]})]})})]})]})]}),e.jsx(H,{value:"testing",className:"space-y-6",children:e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(T,{children:"API Testing Examples"})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Basic Query"}),e.jsx("div",{className:"p-3 bg-muted rounded-lg font-mono text-sm",children:"GET /api/ohlc?symbol=BTCUSDT&interval=1h&limit=100"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Time Range Query"}),e.jsx("div",{className:"p-3 bg-muted rounded-lg font-mono text-sm",children:"GET /api/ohlc?symbol=ETHUSDT&interval=4h&startTime=2024-01-01T00:00:00Z&endTime=2024-01-02T00:00:00Z"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Error: Invalid Ticker"}),e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-950/20 rounded-lg font-mono text-sm",children:"GET /api/ohlc?symbol=INVALID → 400 Bad Request"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Error: Missing Symbol"}),e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-950/20 rounded-lg font-mono text-sm",children:"GET /api/ohlc → 400 Bad Request"})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Test Suite Coverage"}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-2",children:["Parameter validation","Ticker validation","Cache lookup logic","Binance API fallback","Data normalization","Query parameters","Response format","Error handling","Timeout handling","Database errors"].map((s,p)=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded",children:[e.jsx(le,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:s})]},p))})]})]})]})})]})]})]})]})})}export{He as default};
//# sourceMappingURL=historical-ohlc-Dnb4jF9O.js.map
