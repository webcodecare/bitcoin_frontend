{"version":3,"file":"HeatmapChart-D58HunIG.js","sources":["../../src/components/charts/HeatmapChart.tsx"],"sourcesContent":["import { useEffect, useRef } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { TrendingUp, TrendingDown, Activity } from \"lucide-react\";\n\ninterface HeatmapChartProps {\n  symbol?: string;\n  height?: number;\n  className?: string;\n}\n\ninterface HeatmapData {\n  id: string;\n  ticker: string;\n  week: string;\n  sma200w: string;\n  deviationPercent: string;\n  createdAt: string;\n}\n\nexport default function HeatmapChart({\n  symbol = \"BTC\",\n  height = 300,\n  className,\n}: HeatmapChartProps) {\n  const chartContainerRef = useRef<HTMLDivElement>(null);\n\n  const { data: heatmapData, isLoading } = useQuery({\n    queryKey: [`/api/public/chart/heatmap/${symbol}`],\n    refetchInterval: 60000, // Refresh every minute\n  });\n\n  useEffect(() => {\n    if (!chartContainerRef.current) return;\n\n    // Clear any existing chart\n    chartContainerRef.current.innerHTML = '';\n\n    // Create canvas-based heatmap\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    canvas.width = chartContainerRef.current.clientWidth || 400;\n    canvas.height = height;\n    canvas.style.width = '100%';\n    canvas.style.height = `${height}px`;\n\n    chartContainerRef.current.appendChild(canvas);\n\n    // Professional heatmap grid\n    const weeks = 52;\n    const years = 4;\n    const cellWidth = (canvas.width - 80) / weeks;\n    const cellHeight = (canvas.height - 120) / years;\n\n    // Professional color palette based on deviation percentage\n    const getColor = (deviation: number) => {\n      if (deviation < -50) return '#7f1d1d'; // Dark red - deep oversold\n      if (deviation < -25) return '#dc2626'; // Red - oversold\n      if (deviation < -10) return '#f97316'; // Orange - moderately oversold\n      if (deviation < 10) return '#374151'; // Gray - neutral zone\n      if (deviation < 25) return '#059669'; // Green - moderately overbought\n      if (deviation < 50) return '#2563eb'; // Blue - overbought\n      return '#7c3aed'; // Purple - extremely overbought\n    };\n\n    // Draw heatmap grid\n    ctx.fillStyle = 'hsl(var(--muted-foreground))';\n    ctx.font = '10px system-ui';\n\n    for (let year = 0; year < years; year++) {\n      for (let week = 0; week < weeks; week++) {\n        // Use real data if available, otherwise generate realistic sample\n        let deviation: number;\n        if (heatmapData && heatmapData.length > 0) {\n          const dataPoint = heatmapData[Math.min(week, heatmapData.length - 1)];\n          deviation = parseFloat(dataPoint.deviationPercent);\n        } else {\n          // Generate realistic crypto deviation pattern\n          deviation = (Math.sin(week * 0.12) * 30) + \n                     (Math.sin(year * 0.8) * 15) + \n                     (Math.random() * 10 - 5);\n        }\n\n        const x = 20 + week * cellWidth;\n        const y = 40 + year * cellHeight;\n\n        ctx.fillStyle = getColor(deviation);\n        ctx.fillRect(x, y, cellWidth - 1, cellHeight - 1);\n\n        // Add subtle border\n        ctx.strokeStyle = 'hsl(var(--border))';\n        ctx.lineWidth = 0.5;\n        ctx.strokeRect(x, y, cellWidth - 1, cellHeight - 1);\n      }\n    }\n\n    // Add year labels\n    ctx.fillStyle = 'hsl(var(--foreground))';\n    ctx.font = '12px system-ui';\n    ctx.textAlign = 'right';\n    for (let year = 0; year < years; year++) {\n      const y = 40 + year * cellHeight + cellHeight / 2;\n      ctx.fillText(`${2021 + year}`, 15, y + 4);\n    }\n\n    // Add legend\n    const legendY = canvas.height - 30;\n    const legendColors = [\n      { color: '#dc2626', label: '<-50%' },\n      { color: '#ef4444', label: '-25%' },\n      { color: '#f97316', label: '0%' },\n      { color: '#22c55e', label: '+25%' },\n      { color: '#3b82f6', label: '+50%' },\n      { color: '#8b5cf6', label: '>50%' }\n    ];\n\n    ctx.font = '10px system-ui';\n    ctx.textAlign = 'center';\n    legendColors.forEach((item, i) => {\n      const x = 20 + i * (canvas.width - 40) / legendColors.length;\n      ctx.fillStyle = item.color;\n      ctx.fillRect(x, legendY, 20, 15);\n      ctx.fillStyle = 'hsl(var(--foreground))';\n      ctx.fillText(item.label, x + 10, legendY + 25);\n    });\n\n  }, [heatmapData, symbol, height]);\n\n  if (isLoading) {\n    return (\n      <Card className={className}>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Activity className=\"mr-2 h-5 w-5\" />\n            200-Week SMA Heatmap\n          </CardTitle>\n          <CardDescription>Loading heatmap data...</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-center\" style={{ height: `${height}px` }}>\n            <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const currentDeviation = heatmapData && heatmapData.length > 0 \n    ? parseFloat(heatmapData[0].deviationPercent)\n    : 12.5; // Sample value\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center\">\n              <Activity className=\"mr-2 h-5 w-5\" />\n              200-Week SMA Heatmap\n            </CardTitle>\n            <CardDescription>Price deviation from 200-week moving average</CardDescription>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-lg font-bold\">\n              {currentDeviation > 0 ? '+' : ''}{currentDeviation.toFixed(1)}%\n            </div>\n            <div className=\"flex items-center text-sm text-muted-foreground\">\n              {currentDeviation > 0 ? (\n                <TrendingUp className=\"w-3 h-3 mr-1\" />\n              ) : (\n                <TrendingDown className=\"w-3 h-3 mr-1\" />\n              )}\n              Current deviation\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div ref={chartContainerRef} className=\"w-full\" style={{ height: `${height}px` }} />\n        <div className=\"mt-4 text-xs text-muted-foreground\">\n          <p>Green/Blue: Above 200-week SMA (potential profit-taking zones)</p>\n          <p>Red/Orange: Below 200-week SMA (potential accumulation zones)</p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}"],"names":["HeatmapChart","symbol","height","className","chartContainerRef","useRef","heatmapData","isLoading","useQuery","useEffect","canvas","ctx","weeks","years","cellWidth","cellHeight","getColor","deviation","year","week","dataPoint","x","y","legendY","legendColors","item","i","jsxs","Card","CardHeader","CardTitle","jsx","Activity","CardDescription","CardContent","currentDeviation","TrendingUp","TrendingDown"],"mappings":"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"}