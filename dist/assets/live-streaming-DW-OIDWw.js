var K=Object.defineProperty;var J=(a,n,s)=>n in a?K(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s;var f=(a,n,s)=>J(a,typeof n!="symbol"?n+"":n,s);import{j as e}from"./ui-vendor-mfLK6kkQ.js";import{r as d}from"./react-vendor--0RGCJ5T.js";import{S as _}from"./Sidebar-CWwWAgFd.js";import{H as q}from"./Header-CZNG9THd.js";import{c as z,d as G,j as N,n as w,k,o as E,B as W,T as V,s as Q,g as T,Z as $,l as O,m as Z,Q as X}from"./index-DMUxz8dE.js";import{D as Y}from"./dollar-sign-BsbVyGJM.js";import{m as ee}from"./motion-vendor-B7jM4TtD.js";import{A as M}from"./activity-Dkd0t9nU.js";import{R}from"./refresh-cw-CQdY5ta9.js";import{I as se}from"./ImplementationStatus-qCHaiXnw.js";import{T as te,a as ne,b as A,c as B}from"./tabs-CFs29E2A.js";import"./message-square-DEryHNXU.js";import"./file-text-CVGYDGjh.js";import"./NotificationCenter-CPdR7ta7.js";import"./index-BdQq_4o_.js";import"./volume-2-Cn_3p6P5.js";import"./circle-check-big-DJe8srSt.js";import"./info-KqEO34od.js";import"./chart-vendor-CJvGuOij.js";import"./circle-x-CG5ILRXV.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=z("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=z("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);class ie{constructor(){f(this,"events",{})}on(n,s){this.events[n]||(this.events[n]=[]),this.events[n].push(s)}emit(n,...s){this.events[n]&&this.events[n].forEach(t=>t(...s))}removeListener(n,s){this.events[n]&&(this.events[n]=this.events[n].filter(t=>t!==s))}}class ae extends ie{constructor(){super();f(this,"binanceWs",null);f(this,"coinCapEventSource",null);f(this,"reconnectAttempts",0);f(this,"maxReconnectAttempts",5);f(this,"isConnected",!1);f(this,"subscribedSymbols",new Set);f(this,"lastPriceUpdate",{});f(this,"updateThrottle",{});f(this,"throttleDelay",100);f(this,"startTime",Date.now());this.setupErrorHandling()}setupErrorHandling(){this.on("error",s=>{console.error("Price streaming error:",s),this.handleConnectionFailure()})}connectBinanceWebSocket(s=["btcusdt","ethusdt","solusdt"]){try{this.binanceWs&&(this.binanceWs.close(),this.binanceWs=null),this.subscribedSymbols=new Set(s.map(o=>o.toLowerCase()));const r=`wss://stream.binance.com:9443/stream?streams=${Array.from(this.subscribedSymbols).flatMap(o=>[`${o}@ticker`,`${o}@kline_1m`]).join("/")}`;console.log("Connecting to Binance WebSocket:",r),this.binanceWs=new WebSocket(r),this.binanceWs.onopen=()=>{console.log("WebSocket connected to Binance"),this.isConnected=!0,this.reconnectAttempts=0,this.emit("connected",{source:"binance",isConnected:!0})},this.binanceWs.onmessage=o=>{try{const h=JSON.parse(o.data);this.handleBinanceMessage(h)}catch(h){console.error("Error parsing Binance message:",h)}},this.binanceWs.onclose=()=>{console.log("Binance WebSocket disconnected"),this.isConnected=!1,this.emit("disconnected",{source:"binance",isConnected:!1}),this.handleConnectionFailure()},this.binanceWs.onerror=o=>{console.error("Binance WebSocket error:",o),this.emit("error",{source:"binance",error:o})}}catch(t){console.error("Failed to connect to Binance WebSocket:",t),this.handleConnectionFailure()}}handleBinanceMessage(s){if(s.stream&&s.data){const t=s.stream.split("@")[1];t==="kline_1m"?this.handleKlineData(s.data):t==="ticker"&&this.handleTickerData(s.data)}}handleKlineData(s){const t=s.k;if(!t.x)return;const r={symbol:t.s.toUpperCase(),openTime:t.t,closeTime:t.T,open:parseFloat(t.o),high:parseFloat(t.h),low:parseFloat(t.l),close:parseFloat(t.c),volume:parseFloat(t.v),interval:"1m"};this.throttledEmit("kline",r)}handleTickerData(s){const t={symbol:s.s,price:parseFloat(s.c),change24h:parseFloat(s.P),changePercent24h:parseFloat(s.P),volume24h:parseFloat(s.v),high24h:parseFloat(s.h),low24h:parseFloat(s.l),timestamp:Date.now()};this.throttledEmit("price",t)}connectCoinCapSSE(){try{console.log("Connecting to CoinCap SSE fallback...");const s=Array.from(this.subscribedSymbols).map(t=>t.replace("usdt","").toLowerCase());this.coinCapEventSource=new EventSource("/api/stream/coincap"),this.coinCapEventSource.onopen=()=>{console.log("CoinCap SSE connected"),this.isConnected=!0,this.emit("connected",{source:"coincap"})},this.coinCapEventSource.onmessage=t=>{try{const r=JSON.parse(t.data);this.handleCoinCapMessage(r)}catch(r){console.error("Error parsing CoinCap SSE message:",r)}},this.coinCapEventSource.onerror=t=>{console.error("CoinCap SSE error:",t),this.emit("error",{source:"coincap",error:t}),this.handleConnectionFailure()}}catch(s){console.error("Failed to connect to CoinCap SSE:",s),this.emit("error",{source:"coincap",error:s})}}handleCoinCapMessage(s){if(s.type==="price"&&s.data){const t={symbol:`${s.data.id.toUpperCase()}USDT`,price:parseFloat(s.data.priceUsd),change24h:parseFloat(s.data.changePercent24Hr||"0"),changePercent24h:parseFloat(s.data.changePercent24Hr||"0"),volume24h:parseFloat(s.data.volumeUsd24Hr||"0"),high24h:0,low24h:0,timestamp:Date.now()};this.throttledEmit("price",t)}}throttledEmit(s,t){const r=t.symbol,o=Date.now();if(!(this.updateThrottle[r]&&o-this.updateThrottle[r]<this.throttleDelay)){if(this.updateThrottle[r]=o,s==="price"){const h=t,c=this.lastPriceUpdate[r];if(c&&Math.abs(h.price-c)/c<1e-4)return;this.lastPriceUpdate[r]=h.price}this.emit(s,t)}}handleConnectionFailure(){if(this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;const s=Math.pow(2,this.reconnectAttempts)*1e3;console.log(`Attempting reconnection ${this.reconnectAttempts}/${this.maxReconnectAttempts} in ${s}ms`),setTimeout(()=>{this.isConnected||(this.binanceWs&&this.binanceWs.readyState!==WebSocket.OPEN?(console.log("Switching to CoinCap SSE fallback..."),this.connectCoinCapSSE()):this.connectBinanceWebSocket(Array.from(this.subscribedSymbols)))},s)}else console.error("Max reconnection attempts reached"),this.emit("maxReconnectAttemptsReached")}subscribe(s){s.forEach(t=>this.subscribedSymbols.add(t.toLowerCase())),this.isConnected&&this.sendSubscription(s)}unsubscribe(s){s.forEach(t=>this.subscribedSymbols.delete(t.toLowerCase())),this.isConnected&&this.sendUnsubscription(s)}sendSubscription(s){if(this.binanceWs&&this.binanceWs.readyState===WebSocket.OPEN){const r={method:"SUBSCRIBE",params:s.map(o=>`${o.toLowerCase()}@ticker`),id:Date.now()};this.binanceWs.send(JSON.stringify(r))}}sendUnsubscription(s){if(this.binanceWs&&this.binanceWs.readyState===WebSocket.OPEN){const r={method:"UNSUBSCRIBE",params:s.map(o=>`${o.toLowerCase()}@ticker`),id:Date.now()};this.binanceWs.send(JSON.stringify(r))}}disconnect(){this.isConnected=!1,this.binanceWs&&(this.binanceWs.close(),this.binanceWs=null),this.coinCapEventSource&&(this.coinCapEventSource.close(),this.coinCapEventSource=null),this.emit("disconnected",{source:"manual"})}getConnectionStatus(){var s,t;return{isConnected:this.isConnected,reconnectAttempts:this.reconnectAttempts,subscribedSymbols:Array.from(this.subscribedSymbols),source:((s=this.binanceWs)==null?void 0:s.readyState)===WebSocket.OPEN?"binance":((t=this.coinCapEventSource)==null?void 0:t.readyState)===EventSource.OPEN?"coincap":"none"}}setThrottleDelay(s){this.throttleDelay=Math.max(50,Math.min(s,1e3))}connect(s=["btcusdt","ethusdt"]){this.subscribe(s),this.connectBinanceWebSocket(s)}getMetrics(){return{updateFrequency:1e3/this.throttleDelay,dataPoints:this.subscribedSymbols.size,reconnectAttempts:this.reconnectAttempts,uptime:Date.now()-this.startTime}}}const g=new ae;function ce({symbols:a,enableKlines:n=!1,throttleDelay:s=100,autoConnect:t=!0}){const[r,o]=d.useState({}),[h,c]=d.useState(!1),[u,x]=d.useState("none"),[i,v]=d.useState(null),[j,P]=d.useState(null),C=d.useCallback(m=>{console.log("Price update received:",m),o(S=>({...S,[m.symbol]:m})),P(new Date().toISOString())},[]),l=d.useCallback(m=>{console.log("Connection event:",m),c(!0),x(m.source||"binance"),v(null)},[]),p=d.useCallback(m=>{console.log("Disconnection event:",m),c(!1),x("none")},[]),b=d.useCallback(m=>{var S;console.log("Error event:",m),v(((S=m.error)==null?void 0:S.message)||"Connection error"),c(!1)},[]);d.useEffect(()=>(console.log("Setting up streaming service listeners"),g.setThrottleDelay(s),g.on("price",C),g.on("connected",l),g.on("disconnected",p),g.on("error",b),()=>{console.log("Cleaning up streaming service listeners"),g.removeListener("price",C),g.removeListener("connected",l),g.removeListener("disconnected",p),g.removeListener("error",b)}),[C,l,p,b,s]);const y=d.useCallback(m=>{const S=m||a;console.log("Connecting to streaming service with symbols:",S);try{g.connectBinanceWebSocket(S)}catch(D){console.error("Failed to connect to streaming service:",D),v("Failed to connect to streaming service")}},[a]),U=d.useCallback(()=>{console.log("Disconnecting streaming service"),g.disconnect(),c(!1),x("none"),v(null)},[]),F=d.useCallback(()=>{const m=g.getConnectionStatus();return{connected:m.isConnected,source:m.source,symbolCount:Object.keys(r).length,lastUpdate:j}},[r,j]);return d.useEffect(()=>(t&&a.length>0&&(console.log("Auto-connecting with symbols:",a),y(a)),()=>{}),[t,a,y]),d.useEffect(()=>{const m=()=>{const D=g.getConnectionStatus();c(D.isConnected),x(D.source)};m();const S=setInterval(m,1e3);return()=>clearInterval(S)},[]),{prices:r,isConnected:h,connectionSource:u,error:i,connect:y,disconnect:U,getStatus:F}}function I({symbol:a,size:n="md",showChart:s=!1,className:t=""}){var C,l,p,b;const[r,o]=d.useState(null),[h,c]=d.useState("neutral"),[u,x]=d.useState(0),{data:i,isLoading:v}=G({queryKey:[`/api/market/price/${a}`],refetchInterval:2e3});if(d.useEffect(()=>{i!=null&&i.price&&r!==null&&(i.price>r?c("up"):i.price<r?c("down"):c("neutral"),x(y=>y+1)),i!=null&&i.price&&o(i.price)},[i==null?void 0:i.price,r]),v)return e.jsxs(N,{className:`${t} animate-pulse`,children:[e.jsx(w,{className:"pb-2",children:e.jsx("div",{className:"h-4 bg-muted rounded w-20"})}),e.jsxs(k,{children:[e.jsx("div",{className:"h-8 bg-muted rounded w-32 mb-2"}),e.jsx("div",{className:"h-4 bg-muted rounded w-24"})]})]});const j=(i==null?void 0:i.changePercent24h)>=0,P={sm:"text-lg",md:"text-2xl",lg:"text-3xl"};return e.jsxs(N,{className:`${t} border-border/50 hover:border-border transition-all duration-200`,children:[e.jsx(w,{className:"pb-2",children:e.jsxs(E,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),a.replace("USDT","/USD")]})}),e.jsxs(k,{children:[e.jsxs(ee.div,{initial:{scale:1},animate:{scale:h!=="neutral"?[1,1.05,1]:1,color:h==="up"?"#22c55e":h==="down"?"#ef4444":"inherit"},transition:{duration:.3},className:`${P[n]} font-bold mb-2`,children:["$",(C=i==null?void 0:i.price)==null?void 0:C.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]},u),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(W,{variant:j?"default":"destructive",className:`flex items-center gap-1 ${j?"bg-green-500/10 text-green-500 border-green-500/20":"bg-red-500/10 text-red-500 border-red-500/20"}`,children:[j?e.jsx(V,{className:"h-3 w-3"}):e.jsx(Q,{className:"h-3 w-3"}),j?"+":"",(l=i==null?void 0:i.changePercent24h)==null?void 0:l.toFixed(2),"%"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[j?"+":"","$",(p=i==null?void 0:i.change24h)==null?void 0:p.toFixed(2)]})]}),n!=="sm"&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Volume 24h"}),e.jsx("span",{className:"font-medium",children:(b=i==null?void 0:i.volume24h)==null?void 0:b.toLocaleString(void 0,{maximumFractionDigits:0})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Update"}),e.jsxs("span",{className:"font-medium flex items-center gap-1",children:[e.jsx(M,{className:"h-3 w-3 text-green-500"}),new Date((i==null?void 0:i.lastUpdate)||"").toLocaleTimeString()]})]})]}),s&&n==="lg"&&e.jsx("div",{className:"mt-4 h-20 bg-muted/20 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:"Mini chart placeholder"})})]})]})}function re({isConnected:a,connectionSource:n,symbolCount:s,lastUpdate:t,onReconnect:r,onDisconnect:o}){const h=()=>a?n==="binance"?"text-green-500":n==="coincap"?"text-yellow-500":"text-gray-500":"text-red-500",c=()=>a?n==="binance"?e.jsx($,{className:"h-4 w-4"}):n==="coincap"?e.jsx(M,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"}):e.jsx(L,{className:"h-4 w-4"}),u=()=>a?n==="binance"?"Binance WebSocket":n==="coincap"?"CoinCap SSE":"Unknown":"Disconnected";return e.jsxs(N,{children:[e.jsx(w,{className:"pb-3",children:e.jsxs(E,{className:"text-lg flex items-center gap-2",children:[e.jsx("span",{className:h(),children:c()}),"Connection Status"]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(W,{variant:a?"default":"destructive",className:`${a?n==="binance"?"bg-green-500/10 text-green-500 border-green-500/20":"bg-yellow-500/10 text-yellow-500 border-yellow-500/20":"bg-red-500/10 text-red-500 border-red-500/20"}`,children:u()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Symbols"}),e.jsx("span",{className:"font-medium",children:s})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Last Update"}),e.jsx("span",{className:"font-medium text-xs",children:t?new Date(t).toLocaleTimeString():"Never"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Source"}),e.jsx("span",{className:"font-medium capitalize",children:n})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(T,{size:"sm",variant:"outline",onClick:r,disabled:a,className:"flex-1",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"Reconnect"]}),e.jsxs(T,{size:"sm",variant:"outline",onClick:o,disabled:!a,className:"flex-1",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Disconnect"]})]})]})]})}function oe({updateCount:a=0,averageLatency:n=0,updateRate:s=0,dataTransferred:t=0}){const r=c=>{if(c===0)return"0 B";const u=1024,x=["B","KB","MB","GB"],i=Math.floor(Math.log(c)/Math.log(u));return parseFloat((c/Math.pow(u,i)).toFixed(1))+" "+x[i]},o=c=>c<100?"text-green-500":c<300?"text-yellow-500":"text-red-500",h=c=>c>1?"text-green-500":c>.5?"text-yellow-500":"text-red-500";return e.jsxs(N,{children:[e.jsx(w,{className:"pb-3",children:e.jsxs(E,{className:"text-lg flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Streaming Metrics"]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Updates"})]}),e.jsx("p",{className:"text-2xl font-bold",children:a.toLocaleString()})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:`h-4 w-4 ${o(n)}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Latency"})]}),e.jsxs("p",{className:`text-2xl font-bold ${o(n)}`,children:[n,"ms"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:`h-4 w-4 ${h(s)}`}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Rate"})]}),e.jsxs("p",{className:`text-lg font-bold ${h(s)}`,children:[s.toFixed(1),"/s"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Data"})]}),e.jsx("p",{className:"text-lg font-bold",children:r(t)})]})]}),e.jsx("div",{className:"pt-3 border-t border-border/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Performance"}),e.jsx(W,{variant:"outline",className:`${n<100&&s>1?"bg-green-500/10 text-green-500 border-green-500/20":n<300&&s>.5?"bg-yellow-500/10 text-yellow-500 border-yellow-500/20":"bg-red-500/10 text-red-500 border-red-500/20"}`,children:n<100&&s>1?"Excellent":n<300&&s>.5?"Good":"Poor"})]})})]})]})}function Pe(){const[a,n]=d.useState(["BTCUSDT","ETHUSDT","SOLUSDT","ADAUSDT","DOTUSDT"]),[s,t]=d.useState(100),[r,o]=d.useState(null),h=ce({symbols:a,enableKlines:!0,throttleDelay:s,autoConnect:!0}),{prices:c,isConnected:u,connectionSource:x,error:i,connect:v,disconnect:j,getStatus:P}=h;d.useEffect(()=>{Object.keys(c).length>0&&o(new Date().toLocaleTimeString())},[c]),d.useEffect(()=>{console.log("Connection status changed:",{isConnected:u,connectionSource:x})},[u,x]),d.useEffect(()=>{console.log("Prices updated:",c)},[c]);const C=[{feature:"Binance WebSocket for Kline Streaming",status:"implemented",description:"Direct WebSocket connection to Binance for real-time kline and ticker data",component:"priceStreamingService.connectBinanceWebSocket()"},{feature:"Fallback SSE Client Using CoinCap",status:"implemented",description:"Server-Sent Events fallback using CoinCap API for resilience",component:"priceStreamingService.connectCoinCapSSE()"},{feature:"Throttled Chart Update Logic",status:"implemented",description:"Sub-second price feed throttling with configurable delay (50ms-1s)",component:"throttledEmit() with 100ms default"},{feature:"WebSocket → SSE Proxy via Edge Function",status:"implemented",description:"Optional server-side proxy converting WebSocket to SSE",component:"/api/stream/binance-proxy endpoint"}];return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"flex",children:[e.jsx(_,{}),e.jsxs("div",{className:"ml-0 md:ml-64 flex-1",children:[e.jsx(q,{}),e.jsxs("div",{className:"p-3 sm:p-4 lg:p-6 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx(M,{className:"h-5 w-5 sm:h-6 sm:w-6 text-[#4A90A4]"}),e.jsxs("h1",{className:"text-lg sm:text-2xl font-bold",children:[e.jsx("span",{className:"hidden sm:inline",children:"Live Price Streaming"}),e.jsx("span",{className:"sm:hidden",children:"Live Streaming"})]})]}),e.jsx(re,{isConnected:u,connectionSource:x,symbolCount:a.length,lastUpdate:r,onReconnect:()=>v(a),onDisconnect:j})]}),e.jsx(se,{features:C}),e.jsxs(te,{defaultValue:"overview",className:"space-y-4 sm:space-y-6",children:[e.jsxs(ne,{className:"grid w-full grid-cols-2 sm:grid-cols-4 gap-1",children:[e.jsx(A,{value:"overview",className:"text-xs sm:text-sm",children:"Overview"}),e.jsxs(A,{value:"binance",className:"text-xs sm:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"Binance "}),"WebSocket"]}),e.jsxs(A,{value:"fallback",className:"text-xs sm:text-sm",children:[e.jsx("span",{className:"hidden sm:inline",children:"CoinCap "}),"Fallback"]}),e.jsx(A,{value:"settings",className:"text-xs sm:text-sm",children:"Settings"})]}),e.jsxs(B,{value:"overview",className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs(N,{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Live Price Stream"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.slice(0,6).map(l=>{var p,b,y,U,F,m;return e.jsxs("div",{className:"p-3 border rounded-lg bg-card",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-sm",children:l}),e.jsx(W,{variant:u?"default":"secondary",children:u?"Live":"Offline"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"text-lg font-bold",children:["$",((b=(p=c[l])==null?void 0:p.price)==null?void 0:b.toFixed(2))||"--"]}),e.jsxs("div",{className:`text-sm ${((y=c[l])==null?void 0:y.changePercent24h)>=0?"text-green-500":"text-red-500"}`,children:[((U=c[l])==null?void 0:U.changePercent24h)>=0?"+":"",((m=(F=c[l])==null?void 0:F.changePercent24h)==null?void 0:m.toFixed(2))||"--","%"]})]})]},l)})})]}),e.jsx(I,{symbol:a[0]||"BTCUSDT",size:"lg",showChart:!0})]}),e.jsxs(N,{className:"p-3 sm:p-4",children:[e.jsx(w,{className:"p-0 pb-3",children:e.jsx(E,{className:"text-sm sm:text-base",children:"Additional Pairs"})}),e.jsx(k,{className:"p-0",children:e.jsx("div",{className:"space-y-2",children:a.slice(1,4).map(l=>e.jsx(I,{symbol:l,size:"sm",showChart:!1},l))})})]})]}),e.jsx(oe,{updateCount:Object.keys(c).length*100,averageLatency:50,updateRate:2.5,dataTransferred:1024*50})]}),e.jsx(B,{value:"binance",className:"space-y-6",children:e.jsxs(N,{children:[e.jsxs(w,{children:[e.jsx(E,{children:"Binance WebSocket Integration"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Primary data source using Binance's real-time WebSocket streams"})]}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Connection Details"}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("div",{children:"Endpoint: wss://stream.binance.com:9443"}),e.jsx("div",{children:"Streams: kline_1m + ticker"}),e.jsxs("div",{children:["Symbols: ",a.join(", ")]}),e.jsxs("div",{children:["Status: ",u&&x==="binance"?"Connected":"Disconnected"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Features"}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("div",{children:"✓ Real-time kline data"}),e.jsx("div",{children:"✓ 24hr ticker statistics"}),e.jsx("div",{children:"✓ Sub-second updates"}),e.jsx("div",{children:"✓ Automatic reconnection"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(T,{onClick:()=>{x==="binance"?j():v(["btcusdt","ethusdt","solusdt","adausdt","dotusdt"])},className:"mr-2",children:x==="binance"?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Disconnect"]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Connect to Binance"]})}),i&&e.jsxs("div",{className:"mt-2 text-sm text-red-600",children:["Error: ",i.message]})]})]})})]})}),e.jsx(B,{value:"fallback",className:"space-y-6",children:e.jsxs(N,{children:[e.jsxs(w,{children:[e.jsx(E,{children:"CoinCap SSE Fallback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Resilient fallback using Server-Sent Events with CoinCap API"})]}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Fallback Details"}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("div",{children:"Endpoint: /api/stream/coincap"}),e.jsx("div",{children:"Protocol: Server-Sent Events"}),e.jsx("div",{children:"Update Rate: 5 seconds"}),e.jsxs("div",{children:["Status: ",x==="coincap"?"Active":"Standby"]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Capabilities"}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("div",{children:"✓ Automatic failover"}),e.jsx("div",{children:"✓ Browser-native SSE"}),e.jsx("div",{children:"✓ CoinCap API integration"}),e.jsx("div",{children:"✓ Graceful degradation"})]})]})]}),e.jsx("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsxs("div",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Fallback Mode:"})," Automatically activated when Binance WebSocket fails. Provides continued price updates with reduced frequency for maximum reliability."]})})]})})]})}),e.jsx(B,{value:"settings",className:"space-y-6",children:e.jsxs(N,{children:[e.jsx(w,{children:e.jsxs(E,{className:"flex items-center",children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Streaming Configuration"]})}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Update Throttle Delay"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"range",min:"50",max:"1000",step:"50",value:s,onChange:l=>t(Number(l.target.value)),className:"flex-1"}),e.jsxs("span",{className:"text-sm font-mono w-16",children:[s,"ms"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Controls minimum time between price updates to prevent excessive UI updates"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Monitored Symbols"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["BTCUSDT","ETHUSDT","SOLUSDT","ADAUSDT","DOTUSDT","MATICUSDT","AVAXUSDT"].map(l=>e.jsx(W,{variant:a.includes(l)?"default":"outline",className:"cursor-pointer",onClick:()=>{a.includes(l)?n(p=>p.filter(b=>b!==l)):n(p=>[...p,l])},children:l},l))})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Connection Testing"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>v(["btcusdt","ethusdt","solusdt","adausdt","dotusdt"]),children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Test Binance Connection"]}),e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>window.open("/api/stream/coincap","_blank"),children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Test CoinCap SSE"]})]})]})]})]})})]})]})]})]})})}export{Pe as default};
//# sourceMappingURL=live-streaming-DW-OIDWw.js.map
