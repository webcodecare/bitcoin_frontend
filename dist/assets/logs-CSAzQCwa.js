import{j as e}from"./ui-vendor-mfLK6kkQ.js";import{r as R}from"./react-vendor--0RGCJ5T.js";import{b as Q,d as E,g,j as m,n as x,o as h,k as u,ad as P,J as F,y as J,V as U,B as v,Q as X}from"./index-DMUxz8dE.js";import{S as _}from"./Sidebar-CWwWAgFd.js";import{H as G}from"./Header-CZNG9THd.js";import{S as w,a as N,b,c as y,d as r}from"./select-Brp6yn3A.js";import{T as Y,a as Z,b as I,c as d,d as ee,e as c}from"./table-C5Wewpyf.js";import{D as se}from"./download-DAUaHPRv.js";import{A as $}from"./activity-Dkd0t9nU.js";import{C as V}from"./circle-check-big-DJe8srSt.js";import{C as B}from"./circle-x-CG5ILRXV.js";import{S as ae}from"./search-DB-Wf2A-.js";import{I as te}from"./info-KqEO34od.js";import{D as re}from"./database-CQRgTe4X.js";import"./chart-vendor-CJvGuOij.js";import"./dollar-sign-BsbVyGJM.js";import"./message-square-DEryHNXU.js";import"./file-text-CVGYDGjh.js";import"./NotificationCenter-CPdR7ta7.js";import"./index-BdQq_4o_.js";import"./tabs-CFs29E2A.js";import"./volume-2-Cn_3p6P5.js";import"./index-BBVDPgwe.js";import"./chevron-down-BE_ioXd1.js";function Ie(){const{toast:D}=Q(),[a,i]=R.useState({}),[j,S]=R.useState(1),k=50,{data:o,isLoading:q}=E({queryKey:["/api/admin/logs",a,j],queryFn:async()=>{const s=new URLSearchParams;a.userId&&s.append("userId",a.userId),a.action&&s.append("action",a.action),a.resource&&a.resource!=="all"&&s.append("resource",a.resource),a.status&&a.status!=="all"&&s.append("status",a.status),a.dateFrom&&s.append("dateFrom",a.dateFrom),a.dateTo&&s.append("dateTo",a.dateTo),a.search&&s.append("search",a.search),s.append("page",j.toString()),s.append("limit",k.toString());const t=await fetch(`/api/admin/logs?${s}`);if(!t.ok)throw new Error("Failed to fetch admin logs");return await t.json()},refetchInterval:3e4}),{data:C}=E({queryKey:["/api/admin/users"],queryFn:async()=>{const s=await fetch("/api/admin/users");if(!s.ok)throw new Error("Failed to fetch users");return await s.json()}}),l=(o==null?void 0:o.logs)||[],A=(o==null?void 0:o.total)||0,p=Math.ceil(A/k),H=s=>{switch(s){case"success":return e.jsxs(v,{variant:"default",className:"bg-emerald-500",children:[e.jsx(V,{className:"w-3 h-3 mr-1"}),"Success"]});case"error":return e.jsxs(v,{variant:"destructive",children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),"Error"]});case"warning":return e.jsxs(v,{variant:"secondary",className:"bg-yellow-500",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Warning"]});default:return e.jsxs(v,{variant:"outline",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),s]})}},M=s=>s.includes("user")?e.jsx(U,{className:"w-4 h-4"}):s.includes("settings")||s.includes("config")?e.jsx(X,{className:"w-4 h-4"}):s.includes("database")||s.includes("data")?e.jsx(re,{className:"w-4 h-4"}):e.jsx($,{className:"w-4 h-4"}),O=()=>{const s=["Timestamp,User,Action,Resource,Status,Details,IP Address",...l.map(n=>`${n.timestamp},"${n.userEmail}","${n.action}","${n.resource}","${n.status}","${n.details.replace(/"/g,'""')}","${n.ipAddress}"`)].join(`
`),t=new Blob([s],{type:"text/csv"}),L=window.URL.createObjectURL(t),T=document.createElement("a");T.href=L,T.download=`admin-logs-${new Date().toISOString().split("T")[0]}.csv`,T.click(),window.URL.revokeObjectURL(L),D({title:"Success",description:"Admin logs exported successfully"})},W=()=>{i({}),S(1)},z=[...new Set(l.map(s=>s.action))],K=[...new Set(l.map(s=>s.resource))],f={total:A,success:l.filter(s=>s.status==="success").length,errors:l.filter(s=>s.status==="error").length,warnings:l.filter(s=>s.status==="warning").length};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"flex",children:[e.jsx(_,{className:"hidden lg:block lg:w-64"}),e.jsxs("div",{className:"flex-1 lg:ml-64",children:[e.jsx(G,{title:"Admin Activity Logs",subtitle:"View and export administrative activity logs",children:e.jsxs(g,{variant:"outline",onClick:O,children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Export CSV"]})}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6",children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Actions"}),e.jsx($,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:f.total})})]}),e.jsxs(m,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Successful"}),e.jsx(V,{className:"h-4 w-4 text-emerald-500"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:f.success})})]}),e.jsxs(m,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Errors"}),e.jsx(B,{className:"h-4 w-4 text-destructive"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold text-destructive",children:f.errors})})]}),e.jsxs(m,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Warnings"}),e.jsx(P,{className:"h-4 w-4 text-yellow-500"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:f.warnings})})]})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{children:"Filters"})]})}),e.jsxs(u,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsx("div",{children:e.jsx(F,{placeholder:"Search logs...",value:a.search||"",onChange:s=>i(t=>({...t,search:s.target.value}))})}),e.jsxs(w,{value:a.userId||"",onValueChange:s=>i(t=>({...t,userId:s||void 0})),children:[e.jsx(N,{children:e.jsx(b,{placeholder:"User"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All Users"}),C==null?void 0:C.map(s=>e.jsx(r,{value:s.id,children:s.email},s.id))]})]}),e.jsxs(w,{value:a.action||"",onValueChange:s=>i(t=>({...t,action:s||void 0})),children:[e.jsx(N,{children:e.jsx(b,{placeholder:"Action"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All Actions"}),z.map(s=>e.jsx(r,{value:s,children:s},s))]})]}),e.jsxs(w,{value:a.resource||"",onValueChange:s=>i(t=>({...t,resource:s||void 0})),children:[e.jsx(N,{children:e.jsx(b,{placeholder:"Resource"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All Resources"}),K.map(s=>e.jsx(r,{value:s,children:s},s))]})]}),e.jsxs(w,{value:a.status||"",onValueChange:s=>i(t=>({...t,status:s||void 0})),children:[e.jsx(N,{children:e.jsx(b,{placeholder:"Status"})}),e.jsxs(y,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"success",children:"Success"}),e.jsx(r,{value:"error",children:"Error"}),e.jsx(r,{value:"warning",children:"Warning"})]})]}),e.jsx(g,{variant:"outline",onClick:W,children:"Clear Filters"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"From Date"}),e.jsx(F,{type:"datetime-local",value:a.dateFrom||"",onChange:s=>i(t=>({...t,dateFrom:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"To Date"}),e.jsx(F,{type:"datetime-local",value:a.dateTo||"",onChange:s=>i(t=>({...t,dateTo:s.target.value}))})]})]})]})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{children:"Activity Logs"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",l.length," of ",A," logs"]})]})}),e.jsx(u,{children:q?e.jsx("div",{className:"space-y-2",children:[...Array(10)].map((s,t)=>e.jsx(J,{className:"h-12 w-full"},t))}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(I,{children:[e.jsx(d,{children:"Timestamp"}),e.jsx(d,{children:"User"}),e.jsx(d,{children:"Action"}),e.jsx(d,{children:"Resource"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Details"}),e.jsx(d,{children:"IP Address"})]})}),e.jsxs(ee,{children:[l.map(s=>e.jsxs(I,{children:[e.jsx(c,{className:"font-mono text-sm",children:new Date(s.timestamp).toLocaleString()}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"max-w-xs truncate",children:s.userEmail})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[M(s.action),e.jsx("span",{children:s.action})]})}),e.jsx(c,{children:s.resource}),e.jsx(c,{children:H(s.status)}),e.jsx(c,{className:"max-w-sm truncate",children:s.details}),e.jsx(c,{className:"font-mono text-sm",children:s.ipAddress})]},s.id)),l.length===0&&e.jsx(I,{children:e.jsx(c,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No logs found matching your criteria"})})]})]})}),p>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Page ",j," of ",p]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>S(s=>Math.max(s-1,1)),disabled:j===1,children:"Previous"}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>S(s=>Math.min(s+1,p)),disabled:j===p,children:"Next"})]})]})]})})]})]})]})]})})}export{Ie as default};
//# sourceMappingURL=logs-CSAzQCwa.js.map
