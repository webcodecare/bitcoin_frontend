import{j as e}from"./ui-vendor-mfLK6kkQ.js";import{r as p}from"./react-vendor--0RGCJ5T.js";import{b as H,d as F,e as T,j as r,k as n,J as U,ah as y,g as j,n as K,o as V,p as z,D as Q,E as $,F as G,G as J,H as X,I as l,h as _,m as W,B as o,f as M,aq as A}from"./index-DMUxz8dE.js";import{S as Y,a as Z,b as ee,c as se,d as u}from"./select-Brp6yn3A.js";import{T as ae,a as te,b as w,c as b}from"./tabs-CFs29E2A.js";import{S as re}from"./Sidebar-CWwWAgFd.js";import{H as ne}from"./Header-CZNG9THd.js";import{S as le}from"./search-DB-Wf2A-.js";import{F as ie}from"./filter-B2qU7OG2.js";import{R as h}from"./refresh-cw-CQdY5ta9.js";import{C as f}from"./circle-check-big-DJe8srSt.js";import{C as N}from"./circle-x-CG5ILRXV.js";import"./chart-vendor-CJvGuOij.js";import"./index-BdQq_4o_.js";import"./index-BBVDPgwe.js";import"./chevron-down-BE_ioXd1.js";import"./activity-Dkd0t9nU.js";import"./dollar-sign-BsbVyGJM.js";import"./message-square-DEryHNXU.js";import"./file-text-CVGYDGjh.js";import"./NotificationCenter-CPdR7ta7.js";import"./volume-2-Cn_3p6P5.js";import"./info-KqEO34od.js";function Me(){const[i,k]=p.useState(""),[c,I]=p.useState("all"),[a,L]=p.useState(null),[E,C]=p.useState(!1),{toast:g}=H(),{data:v=[],isLoading:q}=F({queryKey:["/api/admin/payments",i,c],queryFn:async()=>{const s=new URLSearchParams;return i&&s.append("search",i),c!=="all"&&s.append("status",c),(await fetch(`/api/admin/payments?${s}`)).json()}}),{data:d}=F({queryKey:["/api/admin/payments/analytics"]}),m=T({mutationFn:async s=>(await M("POST",`/api/admin/payments/${s}/retry`)).json(),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/admin/payments"]}),g({title:"Payment Retry Initiated",description:"The payment retry has been initiated."})},onError:s=>{g({title:"Retry Failed",description:s.message||"Failed to retry payment",variant:"destructive"})}}),S=T({mutationFn:async s=>(await M("POST",`/api/admin/payments/${s}/refund`)).json(),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/admin/payments"]}),g({title:"Refund Processed",description:"The payment refund has been processed."})}}),O=s=>{switch(s){case"succeeded":return e.jsx(f,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(N,{className:"h-4 w-4 text-red-500"});case"pending":return e.jsx(W,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return e.jsx(N,{className:"h-4 w-4 text-gray-500"});case"refunded":return e.jsx(h,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(_,{className:"h-4 w-4 text-gray-500"})}},P=s=>{switch(s){case"succeeded":return e.jsx(o,{variant:"default",className:"bg-green-500",children:"Succeeded"});case"failed":return e.jsx(o,{variant:"destructive",children:"Failed"});case"pending":return e.jsx(o,{variant:"secondary",children:"Pending"});case"cancelled":return e.jsx(o,{variant:"outline",children:"Cancelled"});case"refunded":return e.jsx(o,{variant:"secondary",className:"bg-blue-500",children:"Refunded"});default:return e.jsx(o,{variant:"outline",children:"Unknown"})}},x=(s,t="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(s/100),D=v.filter(s=>{const t=!i||s.userEmail.toLowerCase().includes(i.toLowerCase())||s.stripePaymentId.toLowerCase().includes(i.toLowerCase()),B=c==="all"||s.status===c;return t&&B}),R=s=>{L(s),C(!0)};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"flex",children:[e.jsx(re,{className:"hidden lg:block lg:w-64"}),e.jsxs("div",{className:"flex-1 lg:ml-64",children:[e.jsx(ne,{title:"Payment Management",subtitle:"Monitor payment transactions and gateway responses"}),e.jsxs("div",{className:"p-4 lg:p-6 space-y-6",children:[e.jsxs(ae,{defaultValue:"logs",className:"space-y-4",children:[e.jsxs(te,{children:[e.jsx(w,{value:"logs",children:"Payment Logs"}),e.jsx(w,{value:"analytics",children:"Analytics"}),e.jsx(w,{value:"failed",children:"Failed Payments"})]}),e.jsxs(b,{value:"logs",className:"space-y-4",children:[e.jsx(r,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(U,{placeholder:"Search by email or payment ID...",value:i,onChange:s=>k(s.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(Y,{value:c,onValueChange:I,children:[e.jsx(Z,{className:"w-40",children:e.jsx(ee,{placeholder:"Filter by status"})}),e.jsxs(se,{children:[e.jsx(u,{value:"all",children:"All Status"}),e.jsx(u,{value:"succeeded",children:"Succeeded"}),e.jsx(u,{value:"failed",children:"Failed"}),e.jsx(u,{value:"pending",children:"Pending"}),e.jsx(u,{value:"cancelled",children:"Cancelled"}),e.jsx(u,{value:"refunded",children:"Refunded"})]})]})]})]})})}),e.jsx(r,{children:e.jsx(n,{className:"p-0",children:q?e.jsx("div",{className:"space-y-2 p-4",children:Array.from({length:5}).map((s,t)=>e.jsx("div",{className:"h-16 bg-gray-100 rounded animate-pulse"},t))}):D.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No payment logs found"})]}):e.jsx("div",{className:"divide-y",children:D.map(s=>e.jsxs("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>R(s),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[O(s.status),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.userEmail}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:s.stripePaymentId}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium",children:x(s.amount,s.currency)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.paymentMethod})]}),P(s.status),s.status==="failed"&&e.jsxs(j,{variant:"outline",size:"sm",onClick:t=>{t.stopPropagation(),m.mutate(s.id)},disabled:m.isPending,children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"Retry"]})]})]}),s.errorMessage&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700",children:[e.jsx("strong",{children:"Error:"})," ",s.errorMessage]})]},s.id))})})})]}),e.jsx(b,{value:"analytics",className:"space-y-4",children:d&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(r,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold",children:x(d.totalRevenue)})]}),e.jsx(y,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(r,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Successful Payments"}),e.jsx("p",{className:"text-2xl font-bold",children:d.successfulPayments})]}),e.jsx(f,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(r,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Failed Payments"}),e.jsx("p",{className:"text-2xl font-bold",children:d.failedPayments})]}),e.jsx(N,{className:"h-8 w-8 text-red-500"})]})})}),e.jsx(r,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Refunded Amount"}),e.jsx("p",{className:"text-2xl font-bold",children:x(d.refundedAmount)})]}),e.jsx(h,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(r,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Avg Transaction"}),e.jsx("p",{className:"text-2xl font-bold",children:x(d.averageTransactionAmount)})]}),e.jsx(y,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(r,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Conversion Rate"}),e.jsxs("p",{className:"text-2xl font-bold",children:[d.conversionRate.toFixed(1),"%"]})]}),e.jsx(f,{className:"h-8 w-8 text-green-500"})]})})})]})})}),e.jsx(b,{value:"failed",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(K,{children:[e.jsx(V,{children:"Failed Payments"}),e.jsx(z,{children:"Review and manage failed payment attempts"})]}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-4",children:[v.filter(s=>s.status==="failed").map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-red-50",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(N,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.userEmail}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x(s.amount)," • ",new Date(s.createdAt).toLocaleDateString()]}),s.errorMessage&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:s.errorMessage})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>R(s),children:"View Details"}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>m.mutate(s.id),disabled:m.isPending,children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"Retry"]})]})]},s.id)),v.filter(s=>s.status==="failed").length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(f,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No failed payments"})]})]})})]})})]}),e.jsx(Q,{open:E,onOpenChange:C,children:e.jsxs($,{className:"max-w-2xl",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Payment Details"}),e.jsx(X,{children:"Detailed payment information and gateway response"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Payment ID"}),e.jsx("p",{className:"text-sm",children:a.stripePaymentId})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Status"}),e.jsx("div",{className:"mt-1",children:P(a.status)})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"User Email"}),e.jsx("p",{className:"text-sm",children:a.userEmail})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Amount"}),e.jsx("p",{className:"text-sm",children:x(a.amount,a.currency)})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Payment Method"}),e.jsx("p",{className:"text-sm",children:a.paymentMethod})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Created At"}),e.jsx("p",{className:"text-sm",children:new Date(a.createdAt).toLocaleString()})]})]}),a.errorMessage&&e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Error Message"}),e.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.errorMessage})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-sm font-medium",children:"Gateway Response"}),e.jsx("pre",{className:"text-xs bg-gray-50 p-3 rounded mt-1 overflow-auto max-h-40",children:JSON.stringify(a.gatewayResponse,null,2)})]}),e.jsxs("div",{className:"flex space-x-2",children:[a.status==="succeeded"&&e.jsxs(j,{variant:"outline",onClick:()=>S.mutate(a.id),disabled:S.isPending,children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Process Refund"]}),a.status==="failed"&&e.jsxs(j,{onClick:()=>m.mutate(a.id),disabled:m.isPending,children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Retry Payment"]})]})]})]})})]})]})]})})}export{Me as default};
//# sourceMappingURL=payments-xYo6qi6V.js.map
