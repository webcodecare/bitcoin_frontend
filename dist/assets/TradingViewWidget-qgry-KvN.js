import{j as t}from"./ui-vendor-mfLK6kkQ.js";import{r as u}from"./react-vendor--0RGCJ5T.js";import{b as le,u as ce,d as G,e as K,B as I,j as L,k as D,I as W,g as C,n as _,o as Q,f as X}from"./index-DMUxz8dE.js";import"./chart-vendor-CJvGuOij.js";function ge({symbol:y="BINANCE:BTCUSDT",theme:h="dark",height:J=600,enableTrading:Z=!0,showSignals:S=!0}){const O=u.useRef(null),[oe,U]=u.useState(""),[P,de]=u.useState("market"),[me,z]=u.useState(""),[c,ee]=u.useState([]),[j,te]=u.useState(0),[i,R]=u.useState("simple"),[N,se]=u.useState("5m"),[p,ae]=u.useState(!1),{toast:$}=le();ce(),(()=>{const a=y.includes(":")?y.split(":")[1]:y;return a==="BTCUSDT"||a==="BTCUSD"?["1M","1W","1D","12H","4H","1H","30M"]:["1m","5m","15m","30m","1h","4h","1d","1w"]})();const v=y.includes(":")?y.split(":")[1]:y,{data:d}=G({queryKey:[`/api/market/price/${v}`],refetchInterval:5e3}),{data:T=[]}=G({queryKey:[`/api/signals/${v}`]});K({mutationFn:async a=>X("POST","/api/trading/buy",{ticker:v,amount:a.amount,type:P,price:a.price}),onSuccess:()=>{$({title:"Buy Order Placed",description:`Successfully placed ${P} buy order for ${v}`}),U(""),z("")},onError:a=>{$({title:"Trade Failed",description:a.message,variant:"destructive"})}}),K({mutationFn:async a=>X("POST","/api/trading/sell",{ticker:v,amount:a.amount,type:P,price:a.price}),onSuccess:()=>{$({title:"Sell Order Placed",description:`Successfully placed ${P} sell order for ${v}`}),U(""),z("")},onError:a=>{$({title:"Trade Failed",description:a.message,variant:"destructive"})}}),u.useEffect(()=>{d!=null&&d.price&&(te(d.price),ee(a=>[...a,d.price].slice(-100)))},[d]);const ie=()=>({volume:c.map(()=>Math.random()*1e6+5e5),rsi:c.map((e,g)=>30+Math.sin(g*.1)*20+Math.random()*10),macd:c.map((e,g)=>Math.sin(g*.05)*500+Math.random()*200)});return u.useEffect(()=>{const a=O.current;if(!a||c.length<2)return;const e=a.getContext("2d");if(!e)return;const g=a.getBoundingClientRect();a.width=g.width*devicePixelRatio,a.height=g.height*devicePixelRatio,e.scale(devicePixelRatio,devicePixelRatio);const x=g.width,M=g.height,m=p?M*.8:M;e.fillStyle=h==="dark"?"#0a0a0a":"#ffffff",e.fillRect(0,0,x,M);const k=Math.min(...c),V=Math.max(...c),w=V-k||1,F=ie(),q=i==="simple"?.3:i==="advanced"?.5:.7;e.strokeStyle=h==="dark"?`rgba(255,255,255,${q*.2})`:`rgba(0,0,0,${q*.2})`,e.lineWidth=1;const B=i==="simple"?3:i==="advanced"?5:8;for(let s=0;s<=B;s++){const r=m/B*s;e.beginPath(),e.moveTo(0,r),e.lineTo(x,r),e.stroke();const n=V-w/B*s;e.fillStyle=h==="dark"?"#888888":"#666666",e.font=p?"10px Arial":"12px Arial",e.fillText(`$${n.toFixed(i==="professional"?2:0)}`,5,r-5)}const E=i==="simple"?6:i==="advanced"?10:15;for(let s=0;s<=E;s++){const r=x/E*s;if(e.beginPath(),e.moveTo(r,0),e.lineTo(r,m),e.stroke(),i==="professional"&&s%3===0){const n=Math.round((E-s)*(N==="1m"?1:N==="5m"?5:15));e.fillStyle=h==="dark"?"#666666":"#888888",e.font="10px Arial",e.fillText(`-${n}${N.slice(-1)}`,r+2,m+12)}}const re=i==="simple"?2:i==="advanced"?3:2,ne=i==="simple"?"#00d4aa":i==="advanced"?"#0ea5e9":"#8b5cf6";if(e.strokeStyle=ne,e.lineWidth=re,e.beginPath(),c.forEach((s,r)=>{const n=x/(c.length-1)*r,l=m-(s-k)/w*m;r===0?e.moveTo(n,l):e.lineTo(n,l)}),e.stroke(),i==="advanced"||i==="professional"){const s=[];for(let r=0;r<c.length;r++){const n=Math.max(0,r-19),l=c.slice(n,r+1);s.push(l.reduce((o,f)=>o+f,0)/l.length)}e.strokeStyle="#f59e0b",e.lineWidth=1,e.beginPath(),s.forEach((r,n)=>{const l=x/(s.length-1)*n,o=m-(r-k)/w*m;n===0?e.moveTo(l,o):e.lineTo(l,o)}),e.stroke()}if(i==="professional"&&!p){const s=M*.2,r=m+20,n=Math.max(...F.volume);e.fillStyle=h==="dark"?"rgba(100, 116, 139, 0.6)":"rgba(148, 163, 184, 0.6)",F.volume.forEach((l,o)=>{const f=x/(F.volume.length-1)*o,b=l/n*s;e.fillRect(f-1,r+s-b,2,b)}),e.fillStyle=h==="dark"?"#64748b":"#475569",e.font="10px Arial",e.fillText("Volume",5,r+10)}if(j>0){const s=m-(j-k)/w*m;e.strokeStyle="#ffcc00",e.lineWidth=i==="professional"?2:1,e.setLineDash([5,5]),e.beginPath(),e.moveTo(0,s),e.lineTo(x,s),e.stroke(),e.setLineDash([]);const r=p?12:14;e.font=`bold ${r}px Arial`;const n=`$${j.toFixed(i==="professional"?2:0)}`,l=e.measureText(n).width;if(e.fillStyle=h==="dark"?"rgba(0,0,0,0.8)":"rgba(255,255,255,0.8)",e.fillRect(x-l-10,s-r-2,l+8,r+4),e.fillStyle="#ffcc00",e.fillText(n,x-l-6,s-2),i==="professional"&&c.length>1){const o=c[c.length-2],f=j-o,b=f/o*100;e.font="10px Arial";const A=`${f>=0?"+":""}${f.toFixed(2)} (${b.toFixed(2)}%)`;e.fillStyle=f>=0?"#22c55e":"#ef4444",e.fillText(A,x-l-6,s+12)}}S&&Array.isArray(T)&&T.length>0&&T.forEach((s,r)=>{var b,A;const n=parseFloat(s.price),l=m-(n-k)/w*m,o=i==="simple"?4:i==="advanced"?6:8,f=x-30-r*25;if(i==="professional"&&(e.shadowColor=s.type==="buy"?"#22c55e":"#ef4444",e.shadowBlur=10),e.fillStyle=s.type==="buy"?"#22c55e":"#ef4444",e.beginPath(),e.arc(f,l,o,0,2*Math.PI),e.fill(),e.shadowBlur=0,i==="advanced"||i==="professional"){e.fillStyle=s.type==="buy"?"#22c55e":"#ef4444",e.font=p?"10px Arial":"12px Arial";const Y=i==="professional"?`${((b=s.type)==null?void 0:b.toUpperCase())||"SIGNAL"} $${n.toFixed(0)}`:((A=s.type)==null?void 0:A.toUpperCase())||"SIGNAL",H=e.measureText(Y).width;e.fillStyle=h==="dark"?"rgba(0,0,0,0.7)":"rgba(255,255,255,0.7)",e.fillRect(f-H/2-2,l-o-18,H+4,14),e.fillStyle=s.type==="buy"?"#22c55e":"#ef4444",e.fillText(Y,f-H/2,l-o-8)}})},[c,j,h,S,T,i,N,p]),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-foreground",children:[v," Trading Chart"]}),t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[t.jsxs("span",{children:["Price: $",j.toFixed(2)]}),(d==null?void 0:d.change24h)&&t.jsxs("span",{className:d.change24h>=0?"text-green-400":"text-red-400",children:[d.change24h>=0?"+":"",d.change24h.toFixed(2),"%"]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(I,{variant:"outline",children:"Live"}),t.jsxs(I,{variant:S?"default":"secondary",children:["Signals ",S?"On":"Off"]})]})]}),t.jsx(L,{className:"bg-card border-border mb-4",children:t.jsxs(D,{className:"p-4",children:[t.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(W,{className:"text-sm font-medium text-foreground",children:"View Mode:"}),t.jsxs("div",{className:"flex space-x-1",children:[t.jsx(C,{variant:i==="simple"?"default":"outline",size:"sm",onClick:()=>R("simple"),children:"Simple"}),t.jsx(C,{variant:i==="advanced"?"default":"outline",size:"sm",onClick:()=>R("advanced"),children:"Advanced"}),t.jsx(C,{variant:i==="professional"?"default":"outline",size:"sm",onClick:()=>R("professional"),children:"Pro"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(W,{className:"text-sm font-medium text-foreground",children:"Interval:"}),t.jsx("div",{className:"flex space-x-1",children:["1m","5m","15m","1h","4h","1d"].map(a=>t.jsx(C,{variant:N===a?"default":"outline",size:"sm",onClick:()=>se(a),children:a},a))})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(W,{className:"text-sm font-medium text-foreground",children:"Compact:"}),t.jsx(C,{variant:p?"default":"outline",size:"sm",onClick:()=>ae(!p),children:p?"On":"Off"})]})]}),t.jsxs("div",{className:"mt-3 text-xs text-muted-foreground",children:[i==="simple"&&"Basic price chart with essential trading tools",i==="advanced"&&"Enhanced chart with technical indicators and volume",i==="professional"&&"Full-featured chart with advanced analytics and order book"]})]})}),t.jsxs("div",{className:"relative bg-card border border-border rounded-lg overflow-hidden",children:[t.jsx("canvas",{ref:O,className:"w-full block",style:{height:`${J}px`}}),c.length<2&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-card/80",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-2"}),t.jsx("p",{className:"text-muted-foreground",children:"Loading chart data..."})]})})]}),Z&&t.jsxs(L,{className:"bg-card border-border",children:[t.jsx(_,{children:t.jsx(Q,{className:"text-foreground",children:"Signal Information"})}),t.jsx(D,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-sm text-muted-foreground",children:"This platform provides trading signals and market analysis. Trading signals are for informational purposes only."}),t.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[t.jsx("h4",{className:"font-semibold mb-2",children:"Signal Features"}),t.jsxs("ul",{className:"text-sm space-y-1 text-muted-foreground",children:[t.jsx("li",{children:"• TradingView webhook integration"}),t.jsx("li",{children:"• Real-time buy/sell signal alerts"}),t.jsx("li",{children:"• Multiple timeframe support for BTCUSD"}),t.jsx("li",{children:"• Historical signal tracking"}),t.jsx("li",{children:"• Email and SMS notifications"})]})]}),t.jsxs("div",{className:"text-xs text-muted-foreground p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:[t.jsx("strong",{children:"Disclaimer:"})," This platform does not facilitate actual trading. All signals are for educational and informational purposes only. Users must execute trades on their own trading platforms."]})]})})]}),S&&T.length>0&&t.jsxs(L,{className:"bg-card border-border",children:[t.jsx(_,{children:t.jsx(Q,{className:"text-foreground",children:"Recent Signals"})}),t.jsx(D,{children:t.jsx("div",{className:"space-y-2",children:T.slice(0,3).map(a=>{var e;return t.jsxs("div",{className:"flex items-center justify-between p-2 border border-border rounded",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(I,{variant:a.signalType==="buy"?"default":"destructive",children:((e=a.signalType)==null?void 0:e.toUpperCase())||"N/A"}),t.jsxs("span",{className:"text-foreground",children:["$",a.price]})]}),t.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(a.timestamp).toLocaleTimeString()})]},a.id)})})})]})]})}export{ge as default};
//# sourceMappingURL=TradingViewWidget-qgry-KvN.js.map
