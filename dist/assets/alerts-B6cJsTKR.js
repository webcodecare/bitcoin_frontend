import{j as e}from"./ui-vendor-mfLK6kkQ.js";import{r as A}from"./react-vendor--0RGCJ5T.js";import{c as O,b as B,a as U,d as T,e as f,j as d,n as o,o as h,k as m,D as $,z,g as y,P as J,E as V,F as _,G,H as Q,I as N,J as v,K as X,y as W,B as g,aj as Y,f as x}from"./index-DMUxz8dE.js";import{S as Z}from"./Sidebar-CWwWAgFd.js";import{H as ee}from"./Header-CZNG9THd.js";import{S as se}from"./switch-6PBAG7U5.js";import{T as q,a as D,b as u,c as n,d as L,e as i}from"./table-C5Wewpyf.js";import{A as P}from"./activity-Dkd0t9nU.js";import{C as E}from"./circle-x-CG5ILRXV.js";import{C as F}from"./circle-check-big-DJe8srSt.js";import{T as ae}from"./trash-2-DEwSYusZ.js";import"./chart-vendor-CJvGuOij.js";import"./dollar-sign-BsbVyGJM.js";import"./message-square-DEryHNXU.js";import"./file-text-CVGYDGjh.js";import"./NotificationCenter-CPdR7ta7.js";import"./index-BdQq_4o_.js";import"./tabs-CFs29E2A.js";import"./volume-2-Cn_3p6P5.js";import"./info-KqEO34od.js";import"./index-BBVDPgwe.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=O("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]);function Se(){const{toast:c}=B(),p=U(),[l,j]=A.useState({name:"",url:"",secret:""}),[M,w]=A.useState(!1),{data:r,isLoading:H}=T({queryKey:["/api/admin/webhooks"],queryFn:async()=>await x("/api/admin/webhooks")}),{data:a,isLoading:K}=T({queryKey:["/api/admin/alert-queue"],queryFn:async()=>await x("/api/admin/alert-queue"),refetchInterval:5e3}),b=f({mutationFn:async s=>{await x("/api/admin/webhooks",{method:"POST",body:JSON.stringify(s)})},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/admin/webhooks"]}),j({name:"",url:"",secret:""}),w(!1),c({title:"Success",description:"Webhook configuration created successfully"})},onError:s=>{c({title:"Error",description:s.message,variant:"destructive"})}}),k=f({mutationFn:async({id:s,enabled:t})=>{await x(`/api/admin/webhooks/${s}/toggle`,{method:"PATCH",body:JSON.stringify({enabled:t})})},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/admin/webhooks"]}),c({title:"Success",description:"Webhook status updated"})}}),S=f({mutationFn:async s=>{await x(`/api/admin/webhooks/${s}`,{method:"DELETE"})},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/admin/webhooks"]}),c({title:"Success",description:"Webhook deleted successfully"})}}),C=f({mutationFn:async s=>{await x(`/api/admin/alerts/${s}/retry`,{method:"POST"})},onSuccess:()=>{p.invalidateQueries({queryKey:["/api/admin/alert-queue"]}),c({title:"Success",description:"Alert retry initiated"})}}),R=()=>{if(!l.name||!l.url){c({title:"Error",description:"Name and URL are required",variant:"destructive"});return}if(!l.secret){j(s=>({...s,secret:crypto.randomUUID()}));return}b.mutate(l)},I=s=>{switch(s){case"sent":return e.jsxs(g,{variant:"default",className:"bg-emerald-500",children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),"Sent"]});case"failed":return e.jsxs(g,{variant:"destructive",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"Failed"]});case"pending":return e.jsxs(g,{variant:"secondary",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Pending"]});default:return e.jsx(g,{variant:"outline",children:s})}};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"flex",children:[e.jsx(Z,{className:"hidden lg:block lg:w-64"}),e.jsxs("div",{className:"flex-1 lg:ml-64",children:[e.jsx(ee,{title:"Alert System Management",subtitle:"Manage webhook configurations and alert delivery queue"}),e.jsx("main",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-6",children:[e.jsxs(d,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Active Webhooks"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.filter(s=>s.isEnabled).length)||0})})]}),e.jsxs(d,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Pending Alerts"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.filter(s=>s.status==="pending").length)||0})})]}),e.jsxs(d,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Failed Alerts"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-destructive",children:(a==null?void 0:a.filter(s=>s.status==="failed").length)||0})})]}),e.jsxs(d,{children:[e.jsxs(o,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Success Rate"}),e.jsx(F,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:a!=null&&a.length?`${Math.round(a.filter(s=>s.status==="sent").length/a.length*100)}%`:"100%"})})]})]}),e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Webhook Configurations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure TradingView webhook endpoints"})]}),e.jsxs($,{open:M,onOpenChange:w,children:[e.jsx(z,{asChild:!0,children:e.jsxs(y,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Add Webhook"]})}),e.jsxs(V,{children:[e.jsxs(_,{children:[e.jsx(G,{children:"Create Webhook Configuration"}),e.jsx(Q,{children:"Add a new webhook endpoint for receiving TradingView alerts"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"webhook-name",children:"Name"}),e.jsx(v,{id:"webhook-name",value:l.name,onChange:s=>j(t=>({...t,name:s.target.value})),placeholder:"TradingView Alerts"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"webhook-url",children:"Webhook URL"}),e.jsx(v,{id:"webhook-url",value:l.url,onChange:s=>j(t=>({...t,url:s.target.value})),placeholder:"https://your-domain.com/api/webhook/alerts"})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"webhook-secret",children:"Secret Key (optional)"}),e.jsx(v,{id:"webhook-secret",value:l.secret,onChange:s=>j(t=>({...t,secret:s.target.value})),placeholder:"Leave empty to auto-generate"})]})]}),e.jsx(X,{children:e.jsx(y,{onClick:R,disabled:b.isPending,children:b.isPending?"Creating...":"Create Webhook"})})]})]})]})}),e.jsx(m,{children:H?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((s,t)=>e.jsx(W,{className:"h-16 w-full"},t))}):e.jsxs(q,{children:[e.jsx(D,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"URL"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Total Signals"}),e.jsx(n,{children:"Last Signal"}),e.jsx(n,{children:"Actions"})]})}),e.jsxs(L,{children:[r==null?void 0:r.map(s=>e.jsxs(u,{children:[e.jsx(i,{className:"font-medium",children:s.name}),e.jsx(i,{className:"max-w-xs truncate",children:s.url}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{checked:s.isEnabled,onCheckedChange:t=>k.mutate({id:s.id,enabled:t}),disabled:k.isPending}),e.jsx("span",{className:`text-sm ${s.isEnabled?"text-emerald-600":"text-muted-foreground"}`,children:s.isEnabled?"Active":"Inactive"})]})}),e.jsx(i,{children:s.totalSignals}),e.jsx(i,{children:s.lastSignalAt?new Date(s.lastSignalAt).toLocaleString():"Never"}),e.jsx(i,{children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(y,{variant:"outline",size:"sm",onClick:()=>S.mutate(s.id),disabled:S.isPending,children:e.jsx(ae,{className:"w-3 h-3"})})})})]},s.id)),(!r||r.length===0)&&e.jsx(u,{children:e.jsx(i,{colSpan:6,className:"text-center text-muted-foreground",children:"No webhook configurations found"})})]})]})})]}),e.jsxs(d,{children:[e.jsxs(o,{children:[e.jsx(h,{children:"Alert Delivery Queue"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor alert delivery status and retry failed alerts"})]}),e.jsx(m,{children:K?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,t)=>e.jsx(W,{className:"h-12 w-full"},t))}):e.jsxs(q,{children:[e.jsx(D,{children:e.jsxs(u,{children:[e.jsx(n,{children:"Ticker"}),e.jsx(n,{children:"Signal"}),e.jsx(n,{children:"Price"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Source"}),e.jsx(n,{children:"Created"}),e.jsx(n,{children:"Actions"})]})}),e.jsxs(L,{children:[a==null?void 0:a.slice(0,20).map(s=>e.jsxs(u,{children:[e.jsx(i,{className:"font-medium",children:s.ticker}),e.jsx(i,{children:e.jsx(g,{variant:s.signalType==="buy"?"default":"destructive",children:s.signalType.toUpperCase()})}),e.jsxs(i,{children:["$",s.price]}),e.jsx(i,{children:I(s.status)}),e.jsx(i,{children:s.source}),e.jsx(i,{children:new Date(s.createdAt).toLocaleString()}),e.jsx(i,{children:s.status==="failed"&&e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>C.mutate(s.id),disabled:C.isPending,children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"Retry"]})})]},s.id)),(!a||a.length===0)&&e.jsx(u,{children:e.jsx(i,{colSpan:7,className:"text-center text-muted-foreground",children:"No alerts in queue"})})]})]})})]})]})})]})]})})}export{Se as default};
//# sourceMappingURL=alerts-B6cJsTKR.js.map
